<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PiePlot3D.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JFreeChart</a> &gt; <a href="index.source.html" class="el_package">org.jfree.chart.plot</a> &gt; <span class="el_source">PiePlot3D.java</span></div><h1>PiePlot3D.java</h1><pre class="source lang-java linenums">/* ===========================================================
 * JFreeChart : a free chart library for the Java(tm) platform
 * ===========================================================
 *
 * (C) Copyright 2000-2020, by Object Refinery Limited and Contributors.
 *
 * Project Info:  http://www.jfree.org/jfreechart/index.html
 *
 * This library is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 2.1 of the License, or
 * (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
 * License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 * [Oracle and Java are registered trademarks of Oracle and/or its affiliates.
 * Other names may be trademarks of their respective owners.]
 *
 * --------------
 * PiePlot3D.java
 * --------------
 * (C) Copyright 2000-2020, by Object Refinery and Contributors.
 *
 * Original Author:  Tomer Peretz;
 * Contributor(s):   Richard Atkinson;
 *                   David Gilbert (for Object Refinery Limited);
 *                   Xun Kang;
 *                   Christian W. Zuckschwerdt;
 *                   Arnaud Lelievre;
 *                   Dave Crane;
 *                   Martin Hoeller;
 *                   DaveLaw (dave ATT davelaw DOTT de);
 *
 */

package org.jfree.chart.plot;

import java.awt.AlphaComposite;
import java.awt.Color;
import java.awt.Composite;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics2D;
import java.awt.Paint;
import java.awt.Polygon;
import java.awt.Shape;
import java.awt.Stroke;
import java.awt.geom.Arc2D;
import java.awt.geom.Area;
import java.awt.geom.Ellipse2D;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;
import java.awt.image.BufferedImage;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.jfree.chart.entity.EntityCollection;
import org.jfree.chart.entity.PieSectionEntity;
import org.jfree.chart.event.PlotChangeEvent;
import org.jfree.chart.labels.PieToolTipGenerator;
import org.jfree.chart.ui.RectangleInsets;
import org.jfree.chart.util.PaintAlpha;
import org.jfree.data.general.DatasetUtils;
import org.jfree.data.general.PieDataset;

/**
 * A plot that displays data in the form of a 3D pie chart, using data from
 * any class that implements the {@link PieDataset} interface.
 * &lt;P&gt;
 * Although this class extends {@link PiePlot}, it does not currently support
 * exploded sections.
 */
public class PiePlot3D extends PiePlot implements Serializable {

    /** For serialization. */
    private static final long serialVersionUID = 3408984188945161432L;

    /** The factor of the depth of the pie from the plot height */
<span class="fc" id="L89">    private double depthFactor = 0.12;</span>

    /**
     * A flag that controls whether or not the sides of the pie chart
     * are rendered using a darker colour.
     *
     *  @since 1.0.7.
     */
<span class="fc" id="L97">    private boolean darkerSides = false;  // default preserves previous</span>
                                          // behaviour

    /**
     * Creates a new instance with no dataset.
     */
    public PiePlot3D() {
<span class="fc" id="L104">        this(null);</span>
<span class="fc" id="L105">    }</span>

    /**
     * Creates a pie chart with a three dimensional effect using the specified
     * dataset.
     *
     * @param dataset  the dataset ({@code null} permitted).
     */
    public PiePlot3D(PieDataset dataset) {
<span class="fc" id="L114">        super(dataset);</span>
<span class="fc" id="L115">        setCircular(false, false);</span>
<span class="fc" id="L116">    }</span>

    /**
     * Returns the depth factor for the chart.
     *
     * @return The depth factor.
     *
     * @see #setDepthFactor(double)
     */
    public double getDepthFactor() {
<span class="nc" id="L126">        return this.depthFactor;</span>
    }

    /**
     * Sets the pie depth as a percentage of the height of the plot area, and
     * sends a {@link PlotChangeEvent} to all registered listeners.
     *
     * @param factor  the depth factor (for example, 0.20 is twenty percent).
     *
     * @see #getDepthFactor()
     */
    public void setDepthFactor(double factor) {
<span class="fc" id="L138">        this.depthFactor = factor;</span>
<span class="fc" id="L139">        fireChangeEvent();</span>
<span class="fc" id="L140">    }</span>

    /**
     * Returns a flag that controls whether or not the sides of the pie chart
     * are rendered using a darker colour.
     *
     * @return A boolean.
     *
     * @see #setDarkerSides(boolean)
     *
     * @since 1.0.7
     */
    public boolean getDarkerSides() {
<span class="fc" id="L153">        return this.darkerSides;</span>
    }

    /**
     * Sets a flag that controls whether or not the sides of the pie chart
     * are rendered using a darker colour, and sends a {@link PlotChangeEvent}
     * to all registered listeners.
     *
     * @param darker true to darken the sides, false to use the default
     *         behaviour.
     *
     * @see #getDarkerSides()
     *
     * @since 1.0.7.
     */
    public void setDarkerSides(boolean darker) {
<span class="fc" id="L169">        this.darkerSides = darker;</span>
<span class="fc" id="L170">        fireChangeEvent();</span>
<span class="fc" id="L171">    }</span>

    /**
     * Draws the plot on a Java 2D graphics device (such as the screen or a
     * printer).  This method is called by the
     * {@link org.jfree.chart.JFreeChart} class, you don't normally need
     * to call it yourself.
     *
     * @param g2  the graphics device.
     * @param plotArea  the area within which the plot should be drawn.
     * @param anchor  the anchor point.
     * @param parentState  the state from the parent plot, if there is one.
     * @param info  collects info about the drawing
     *              ({@code null} permitted).
     */
    @Override
    public void draw(Graphics2D g2, Rectangle2D plotArea, Point2D anchor,
                     PlotState parentState, PlotRenderingInfo info) {

        // adjust for insets...
<span class="fc" id="L191">        RectangleInsets insets = getInsets();</span>
<span class="fc" id="L192">        insets.trim(plotArea);</span>

<span class="fc" id="L194">        Rectangle2D originalPlotArea = (Rectangle2D) plotArea.clone();</span>
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">        if (info != null) {</span>
<span class="nc" id="L196">            info.setPlotArea(plotArea);</span>
<span class="nc" id="L197">            info.setDataArea(plotArea);</span>
        }

<span class="fc" id="L200">        drawBackground(g2, plotArea);</span>

<span class="fc" id="L202">        Shape savedClip = g2.getClip();</span>
<span class="fc" id="L203">        g2.clip(plotArea);</span>

<span class="fc" id="L205">        Graphics2D savedG2 = g2;</span>
<span class="fc" id="L206">        BufferedImage dataImage = null;</span>
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">        if (getShadowGenerator() != null) {</span>
<span class="nc" id="L208">            dataImage = new BufferedImage((int) plotArea.getWidth(),</span>
<span class="nc" id="L209">                (int) plotArea.getHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L210">            g2 = dataImage.createGraphics();</span>
<span class="nc" id="L211">            g2.translate(-plotArea.getX(), -plotArea.getY());</span>
<span class="nc" id="L212">            g2.setRenderingHints(savedG2.getRenderingHints());</span>
<span class="nc" id="L213">            originalPlotArea = (Rectangle2D) plotArea.clone();</span>
        }
        // adjust the plot area by the interior spacing value
<span class="fc" id="L216">        double gapPercent = getInteriorGap();</span>
<span class="fc" id="L217">        double labelPercent = 0.0;</span>
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">        if (getLabelGenerator() != null) {</span>
<span class="fc" id="L219">            labelPercent = getLabelGap() + getMaximumLabelWidth();</span>
        }
<span class="fc" id="L221">        double gapHorizontal = plotArea.getWidth() * (gapPercent</span>
                + labelPercent) * 2.0;
<span class="fc" id="L223">        double gapVertical = plotArea.getHeight() * gapPercent * 2.0;</span>

        if (DEBUG_DRAW_INTERIOR) {
            double hGap = plotArea.getWidth() * getInteriorGap();
            double vGap = plotArea.getHeight() * getInteriorGap();
            double igx1 = plotArea.getX() + hGap;
            double igx2 = plotArea.getMaxX() - hGap;
            double igy1 = plotArea.getY() + vGap;
            double igy2 = plotArea.getMaxY() - vGap;
            g2.setPaint(Color.lightGray);
            g2.draw(new Rectangle2D.Double(igx1, igy1, igx2 - igx1,
                    igy2 - igy1));
        }

<span class="fc" id="L237">        double linkX = plotArea.getX() + gapHorizontal / 2;</span>
<span class="fc" id="L238">        double linkY = plotArea.getY() + gapVertical / 2;</span>
<span class="fc" id="L239">        double linkW = plotArea.getWidth() - gapHorizontal;</span>
<span class="fc" id="L240">        double linkH = plotArea.getHeight() - gapVertical;</span>

        // make the link area a square if the pie chart is to be circular...
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">        if (isCircular()) { // is circular?</span>
<span class="nc" id="L244">            double min = Math.min(linkW, linkH) / 2;</span>
<span class="nc" id="L245">            linkX = (linkX + linkX + linkW) / 2 - min;</span>
<span class="nc" id="L246">            linkY = (linkY + linkY + linkH) / 2 - min;</span>
<span class="nc" id="L247">            linkW = 2 * min;</span>
<span class="nc" id="L248">            linkH = 2 * min;</span>
        }

<span class="fc" id="L251">        PiePlotState state = initialise(g2, plotArea, this, null, info);</span>

        // the link area defines the dog leg points for the linking lines to
        // the labels
<span class="fc" id="L255">        Rectangle2D linkAreaXX = new Rectangle2D.Double(linkX, linkY, linkW,</span>
                linkH * (1 - this.depthFactor));
<span class="fc" id="L257">        state.setLinkArea(linkAreaXX);</span>

        if (DEBUG_DRAW_LINK_AREA) {
            g2.setPaint(Color.BLUE);
            g2.draw(linkAreaXX);
            g2.setPaint(Color.YELLOW);
            g2.draw(new Ellipse2D.Double(linkAreaXX.getX(), linkAreaXX.getY(),
                    linkAreaXX.getWidth(), linkAreaXX.getHeight()));
        }

        // the explode area defines the max circle/ellipse for the exploded pie
        // sections.
        // it is defined by shrinking the linkArea by the linkMargin factor.
<span class="fc" id="L270">        double hh = linkW * getLabelLinkMargin();</span>
<span class="fc" id="L271">        double vv = linkH * getLabelLinkMargin();</span>
<span class="fc" id="L272">        Rectangle2D explodeArea = new Rectangle2D.Double(linkX + hh / 2.0,</span>
                linkY + vv / 2.0, linkW - hh, linkH - vv);

<span class="fc" id="L275">        state.setExplodedPieArea(explodeArea);</span>

        // the pie area defines the circle/ellipse for regular pie sections.
        // it is defined by shrinking the explodeArea by the explodeMargin
        // factor.
<span class="fc" id="L280">        double maximumExplodePercent = getMaximumExplodePercent();</span>
<span class="fc" id="L281">        double percent = maximumExplodePercent / (1.0 + maximumExplodePercent);</span>

<span class="fc" id="L283">        double h1 = explodeArea.getWidth() * percent;</span>
<span class="fc" id="L284">        double v1 = explodeArea.getHeight() * percent;</span>
<span class="fc" id="L285">        Rectangle2D pieArea = new Rectangle2D.Double(explodeArea.getX()</span>
<span class="fc" id="L286">                + h1 / 2.0, explodeArea.getY() + v1 / 2.0,</span>
<span class="fc" id="L287">                explodeArea.getWidth() - h1, explodeArea.getHeight() - v1);</span>

        // the link area defines the dog-leg point for the linking lines to
        // the labels
<span class="fc" id="L291">        int depth = (int) (pieArea.getHeight() * this.depthFactor);</span>
<span class="fc" id="L292">        Rectangle2D linkArea = new Rectangle2D.Double(linkX, linkY, linkW,</span>
                linkH - depth);
<span class="fc" id="L294">        state.setLinkArea(linkArea);</span>

<span class="fc" id="L296">        state.setPieArea(pieArea);</span>
<span class="fc" id="L297">        state.setPieCenterX(pieArea.getCenterX());</span>
<span class="fc" id="L298">        state.setPieCenterY(pieArea.getCenterY() - depth / 2.0);</span>
<span class="fc" id="L299">        state.setPieWRadius(pieArea.getWidth() / 2.0);</span>
<span class="fc" id="L300">        state.setPieHRadius((pieArea.getHeight() - depth) / 2.0);</span>

        // get the data source - return if null;
<span class="fc" id="L303">        PieDataset dataset = getDataset();</span>
<span class="fc bfc" id="L304" title="All 2 branches covered.">        if (DatasetUtils.isEmptyOrNull(getDataset())) {</span>
<span class="fc" id="L305">            drawNoDataMessage(g2, plotArea);</span>
<span class="fc" id="L306">            g2.setClip(savedClip);</span>
<span class="fc" id="L307">            drawOutline(g2, plotArea);</span>
<span class="fc" id="L308">            return;</span>
        }

        // if too any elements
<span class="pc bpc" id="L312" title="1 of 2 branches missed.">        if (dataset.getKeys().size() &gt; plotArea.getWidth()) {</span>
<span class="nc" id="L313">            String text = localizationResources.getString(&quot;Too_many_elements&quot;);</span>
<span class="nc" id="L314">            Font sfont = new Font(&quot;dialog&quot;, Font.BOLD, 10);</span>
<span class="nc" id="L315">            g2.setFont(sfont);</span>
<span class="nc" id="L316">            FontMetrics fm = g2.getFontMetrics(sfont);</span>
<span class="nc" id="L317">            int stringWidth = fm.stringWidth(text);</span>

<span class="nc" id="L319">            g2.drawString(text, (int) (plotArea.getX() + (plotArea.getWidth()</span>
<span class="nc" id="L320">                    - stringWidth) / 2), (int) (plotArea.getY()</span>
<span class="nc" id="L321">                    + (plotArea.getHeight() / 2)));</span>
<span class="nc" id="L322">            return;</span>
        }
        // if we are drawing a perfect circle, we need to readjust the top left
        // coordinates of the drawing area for the arcs to arrive at this
        // effect.
<span class="pc bpc" id="L327" title="1 of 2 branches missed.">        if (isCircular()) {</span>
<span class="nc" id="L328">            double min = Math.min(plotArea.getWidth(),</span>
<span class="nc" id="L329">                    plotArea.getHeight()) / 2;</span>
<span class="nc" id="L330">            plotArea = new Rectangle2D.Double(plotArea.getCenterX() - min,</span>
<span class="nc" id="L331">                    plotArea.getCenterY() - min, 2 * min, 2 * min);</span>
        }
        // get a list of keys...
<span class="fc" id="L334">        List sectionKeys = dataset.getKeys();</span>

<span class="pc bpc" id="L336" title="1 of 2 branches missed.">        if (sectionKeys.isEmpty()) {</span>
<span class="nc" id="L337">            return;</span>
        }

        // establish the coordinates of the top left corner of the drawing area
<span class="fc" id="L341">        double arcX = pieArea.getX();</span>
<span class="fc" id="L342">        double arcY = pieArea.getY();</span>

        //g2.clip(clipArea);
<span class="fc" id="L345">        Composite originalComposite = g2.getComposite();</span>
<span class="fc" id="L346">        g2.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER,</span>
<span class="fc" id="L347">                getForegroundAlpha()));</span>

<span class="fc" id="L349">        double totalValue = DatasetUtils.calculatePieDatasetTotal(dataset);</span>
<span class="fc" id="L350">        double runningTotal = 0;</span>
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">        if (depth &lt; 0) {</span>
<span class="nc" id="L352">            return;  // if depth is negative don't draw anything</span>
        }

<span class="fc" id="L355">        ArrayList arcList = new ArrayList();</span>
        Arc2D.Double arc;
        Paint paint;
        Paint outlinePaint;
        Stroke outlineStroke;

<span class="fc" id="L361">        Iterator iterator = sectionKeys.iterator();</span>
<span class="fc bfc" id="L362" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>

<span class="fc" id="L364">            Comparable currentKey = (Comparable) iterator.next();</span>
<span class="fc" id="L365">            Number dataValue = dataset.getValue(currentKey);</span>
<span class="fc bfc" id="L366" title="All 2 branches covered.">            if (dataValue == null) {</span>
<span class="fc" id="L367">                arcList.add(null);</span>
<span class="fc" id="L368">                continue;</span>
            }
<span class="fc" id="L370">            double value = dataValue.doubleValue();</span>
<span class="pc bpc" id="L371" title="1 of 2 branches missed.">            if (value &lt;= 0) {</span>
<span class="nc" id="L372">                arcList.add(null);</span>
<span class="nc" id="L373">                continue;</span>
            }
<span class="fc" id="L375">            double startAngle = getStartAngle();</span>
<span class="fc" id="L376">            double direction = getDirection().getFactor();</span>
<span class="fc" id="L377">            double angle1 = startAngle + (direction * (runningTotal * 360))</span>
                    / totalValue;
<span class="fc" id="L379">            double angle2 = startAngle + (direction * (runningTotal + value)</span>
                    * 360) / totalValue;
<span class="pc bpc" id="L381" title="1 of 2 branches missed.">            if (Math.abs(angle2 - angle1) &gt; getMinimumArcAngleToDraw()) {</span>
<span class="fc" id="L382">                arcList.add(new Arc2D.Double(arcX, arcY + depth,</span>
<span class="fc" id="L383">                        pieArea.getWidth(), pieArea.getHeight() - depth,</span>
                        angle1, angle2 - angle1, Arc2D.PIE));
            }
            else {
<span class="nc" id="L387">                arcList.add(null);</span>
            }
<span class="fc" id="L389">            runningTotal += value;</span>
<span class="fc" id="L390">        }</span>

<span class="fc" id="L392">        Shape oldClip = g2.getClip();</span>

<span class="fc" id="L394">        Ellipse2D top = new Ellipse2D.Double(pieArea.getX(), pieArea.getY(),</span>
<span class="fc" id="L395">                pieArea.getWidth(), pieArea.getHeight() - depth);</span>

<span class="fc" id="L397">        Ellipse2D bottom = new Ellipse2D.Double(pieArea.getX(), pieArea.getY()</span>
<span class="fc" id="L398">                + depth, pieArea.getWidth(), pieArea.getHeight() - depth);</span>

<span class="fc" id="L400">        Rectangle2D lower = new Rectangle2D.Double(top.getX(),</span>
<span class="fc" id="L401">                top.getCenterY(), pieArea.getWidth(), bottom.getMaxY()</span>
<span class="fc" id="L402">                - top.getCenterY());</span>

<span class="fc" id="L404">        Rectangle2D upper = new Rectangle2D.Double(pieArea.getX(), top.getY(),</span>
<span class="fc" id="L405">                pieArea.getWidth(), bottom.getCenterY() - top.getY());</span>

<span class="fc" id="L407">        Area a = new Area(top);</span>
<span class="fc" id="L408">        a.add(new Area(lower));</span>
<span class="fc" id="L409">        Area b = new Area(bottom);</span>
<span class="fc" id="L410">        b.add(new Area(upper));</span>
<span class="fc" id="L411">        Area pie = new Area(a);</span>
<span class="fc" id="L412">        pie.intersect(b);</span>

<span class="fc" id="L414">        Area front = new Area(pie);</span>
<span class="fc" id="L415">        front.subtract(new Area(top));</span>

<span class="fc" id="L417">        Area back = new Area(pie);</span>
<span class="fc" id="L418">        back.subtract(new Area(bottom));</span>

        // draw the bottom circle
        int[] xs;
        int[] ys;

<span class="fc" id="L424">        int categoryCount = arcList.size();</span>
<span class="fc bfc" id="L425" title="All 2 branches covered.">        for (int categoryIndex = 0; categoryIndex &lt; categoryCount;</span>
<span class="fc" id="L426">                 categoryIndex++) {</span>
<span class="fc" id="L427">            arc = (Arc2D.Double) arcList.get(categoryIndex);</span>
<span class="fc bfc" id="L428" title="All 2 branches covered.">            if (arc == null) {</span>
<span class="fc" id="L429">                continue;</span>
            }
<span class="fc" id="L431">            Comparable key = getSectionKey(categoryIndex);</span>
<span class="fc" id="L432">            paint = lookupSectionPaint(key);</span>
<span class="fc" id="L433">            outlinePaint = lookupSectionOutlinePaint(key);</span>
<span class="fc" id="L434">            outlineStroke = lookupSectionOutlineStroke(key);</span>
<span class="fc" id="L435">            g2.setPaint(paint);</span>
<span class="fc" id="L436">            g2.fill(arc);</span>
<span class="fc" id="L437">            g2.setPaint(outlinePaint);</span>
<span class="fc" id="L438">            g2.setStroke(outlineStroke);</span>
<span class="fc" id="L439">            g2.draw(arc);</span>
<span class="fc" id="L440">            g2.setPaint(paint);</span>

<span class="fc" id="L442">            Point2D p1 = arc.getStartPoint();</span>

            // draw the height
<span class="fc" id="L445">            xs = new int[] {(int) arc.getCenterX(), (int) arc.getCenterX(),</span>
<span class="fc" id="L446">                    (int) p1.getX(), (int) p1.getX()};</span>
<span class="fc" id="L447">            ys = new int[] {(int) arc.getCenterY(), (int) arc.getCenterY()</span>
<span class="fc" id="L448">                    - depth, (int) p1.getY() - depth, (int) p1.getY()};</span>
<span class="fc" id="L449">            Polygon polygon = new Polygon(xs, ys, 4);</span>
<span class="fc" id="L450">            g2.setPaint(java.awt.Color.lightGray);</span>
<span class="fc" id="L451">            g2.fill(polygon);</span>
<span class="fc" id="L452">            g2.setPaint(outlinePaint);</span>
<span class="fc" id="L453">            g2.setStroke(outlineStroke);</span>
<span class="fc" id="L454">            g2.draw(polygon);</span>
<span class="fc" id="L455">            g2.setPaint(paint);</span>

        }

<span class="fc" id="L459">        g2.setPaint(Color.GRAY);</span>
<span class="fc" id="L460">        g2.fill(back);</span>
<span class="fc" id="L461">        g2.fill(front);</span>

        // cycle through once drawing only the sides at the back...
<span class="fc" id="L464">        int cat = 0;</span>
<span class="fc" id="L465">        iterator = arcList.iterator();</span>
<span class="fc bfc" id="L466" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L467">            Arc2D segment = (Arc2D) iterator.next();</span>
<span class="fc bfc" id="L468" title="All 2 branches covered.">            if (segment != null) {</span>
<span class="fc" id="L469">                Comparable key = getSectionKey(cat);</span>
<span class="fc" id="L470">                paint = lookupSectionPaint(key);</span>
<span class="fc" id="L471">                outlinePaint = lookupSectionOutlinePaint(key);</span>
<span class="fc" id="L472">                outlineStroke = lookupSectionOutlineStroke(key);</span>
<span class="fc" id="L473">                drawSide(g2, pieArea, segment, front, back, paint,</span>
                        outlinePaint, outlineStroke, false, true);
            }
<span class="fc" id="L476">            cat++;</span>
<span class="fc" id="L477">        }</span>

        // cycle through again drawing only the sides at the front...
<span class="fc" id="L480">        cat = 0;</span>
<span class="fc" id="L481">        iterator = arcList.iterator();</span>
<span class="fc bfc" id="L482" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L483">            Arc2D segment = (Arc2D) iterator.next();</span>
<span class="fc bfc" id="L484" title="All 2 branches covered.">            if (segment != null) {</span>
<span class="fc" id="L485">                Comparable key = getSectionKey(cat);</span>
<span class="fc" id="L486">                paint = lookupSectionPaint(key);</span>
<span class="fc" id="L487">                outlinePaint = lookupSectionOutlinePaint(key);</span>
<span class="fc" id="L488">                outlineStroke = lookupSectionOutlineStroke(key);</span>
<span class="fc" id="L489">                drawSide(g2, pieArea, segment, front, back, paint,</span>
                        outlinePaint, outlineStroke, true, false);
            }
<span class="fc" id="L492">            cat++;</span>
<span class="fc" id="L493">        }</span>

<span class="fc" id="L495">        g2.setClip(oldClip);</span>

        // draw the sections at the top of the pie (and set up tooltips)...
        Arc2D upperArc;
<span class="fc bfc" id="L499" title="All 2 branches covered.">        for (int sectionIndex = 0; sectionIndex &lt; categoryCount;</span>
<span class="fc" id="L500">                 sectionIndex++) {</span>
<span class="fc" id="L501">            arc = (Arc2D.Double) arcList.get(sectionIndex);</span>
<span class="fc bfc" id="L502" title="All 2 branches covered.">            if (arc == null) {</span>
<span class="fc" id="L503">                continue;</span>
            }
<span class="fc" id="L505">            upperArc = new Arc2D.Double(arcX, arcY, pieArea.getWidth(),</span>
<span class="fc" id="L506">                    pieArea.getHeight() - depth, arc.getAngleStart(),</span>
<span class="fc" id="L507">                    arc.getAngleExtent(), Arc2D.PIE);</span>

<span class="fc" id="L509">            Comparable currentKey = (Comparable) sectionKeys.get(sectionIndex);</span>
<span class="fc" id="L510">            paint = lookupSectionPaint(currentKey, true);</span>
<span class="fc" id="L511">            outlinePaint = lookupSectionOutlinePaint(currentKey);</span>
<span class="fc" id="L512">            outlineStroke = lookupSectionOutlineStroke(currentKey);</span>
<span class="fc" id="L513">            g2.setPaint(paint);</span>
<span class="fc" id="L514">            g2.fill(upperArc);</span>
<span class="fc" id="L515">            g2.setStroke(outlineStroke);</span>
<span class="fc" id="L516">            g2.setPaint(outlinePaint);</span>
<span class="fc" id="L517">            g2.draw(upperArc);</span>

           // add a tooltip for the section...
<span class="pc bpc" id="L520" title="1 of 2 branches missed.">            if (info != null) {</span>
<span class="nc" id="L521">                EntityCollection entities</span>
<span class="nc" id="L522">                        = info.getOwner().getEntityCollection();</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">                if (entities != null) {</span>
<span class="nc" id="L524">                    String tip = null;</span>
<span class="nc" id="L525">                    PieToolTipGenerator tipster = getToolTipGenerator();</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">                    if (tipster != null) {</span>
                        // @mgs: using the method's return value was missing
<span class="nc" id="L528">                        tip = tipster.generateToolTip(dataset, currentKey);</span>
                    }
<span class="nc" id="L530">                    String url = null;</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">                    if (getURLGenerator() != null) {</span>
<span class="nc" id="L532">                        url = getURLGenerator().generateURL(dataset, currentKey,</span>
<span class="nc" id="L533">                                getPieIndex());</span>
                    }
<span class="nc" id="L535">                    PieSectionEntity entity = new PieSectionEntity(</span>
<span class="nc" id="L536">                            upperArc, dataset, getPieIndex(), sectionIndex,</span>
                            currentKey, tip, url);
<span class="nc" id="L538">                    entities.add(entity);</span>
                }
            }
        }

<span class="fc" id="L543">        List keys = dataset.getKeys();</span>
<span class="fc" id="L544">        Rectangle2D adjustedPlotArea = new Rectangle2D.Double(</span>
<span class="fc" id="L545">                originalPlotArea.getX(), originalPlotArea.getY(),</span>
<span class="fc" id="L546">                originalPlotArea.getWidth(), originalPlotArea.getHeight()</span>
                - depth);
<span class="pc bpc" id="L548" title="1 of 2 branches missed.">        if (getSimpleLabels()) {</span>
<span class="nc" id="L549">            drawSimpleLabels(g2, keys, totalValue, adjustedPlotArea,</span>
                    linkArea, state);
        }
        else {
<span class="fc" id="L553">            drawLabels(g2, keys, totalValue, adjustedPlotArea, linkArea,</span>
                    state);
        }

<span class="pc bpc" id="L557" title="1 of 2 branches missed.">        if (getShadowGenerator() != null) {</span>
<span class="nc" id="L558">            BufferedImage shadowImage</span>
<span class="nc" id="L559">                    = getShadowGenerator().createDropShadow(dataImage);</span>
<span class="nc" id="L560">            g2 = savedG2;</span>
<span class="nc" id="L561">            g2.drawImage(shadowImage, (int) plotArea.getX()</span>
<span class="nc" id="L562">                    + getShadowGenerator().calculateOffsetX(),</span>
<span class="nc" id="L563">                    (int) plotArea.getY()</span>
<span class="nc" id="L564">                    + getShadowGenerator().calculateOffsetY(), null);</span>
<span class="nc" id="L565">            g2.drawImage(dataImage, (int) plotArea.getX(),</span>
<span class="nc" id="L566">                    (int) plotArea.getY(), null);</span>
        }

<span class="fc" id="L569">        g2.setClip(savedClip);</span>
<span class="fc" id="L570">        g2.setComposite(originalComposite);</span>
<span class="fc" id="L571">        drawOutline(g2, originalPlotArea);</span>

<span class="fc" id="L573">    }</span>

    /**
     * Draws the side of a pie section.
     *
     * @param g2  the graphics device.
     * @param plotArea  the plot area.
     * @param arc  the arc.
     * @param front  the front of the pie.
     * @param back  the back of the pie.
     * @param paint  the color.
     * @param outlinePaint  the outline paint.
     * @param outlineStroke  the outline stroke.
     * @param drawFront  draw the front?
     * @param drawBack  draw the back?
     */
    protected void drawSide(Graphics2D g2,
                            Rectangle2D plotArea,
                            Arc2D arc,
                            Area front,
                            Area back,
                            Paint paint,
                            Paint outlinePaint,
                            Stroke outlineStroke,
                            boolean drawFront,
                            boolean drawBack) {

<span class="pc bpc" id="L600" title="1 of 2 branches missed.">        if (getDarkerSides()) {</span>
<span class="nc" id="L601">             paint = PaintAlpha.darker(paint);</span>
        }

<span class="fc" id="L604">        double start = arc.getAngleStart();</span>
<span class="fc" id="L605">        double extent = arc.getAngleExtent();</span>
<span class="fc" id="L606">        double end = start + extent;</span>

<span class="fc" id="L608">        g2.setStroke(outlineStroke);</span>

        // for CLOCKWISE charts, the extent will be negative...
<span class="pc bpc" id="L611" title="1 of 2 branches missed.">        if (extent &lt; 0.0) {</span>

<span class="fc bfc" id="L613" title="All 2 branches covered.">            if (isAngleAtFront(start)) {  // start at front</span>

<span class="pc bpc" id="L615" title="1 of 2 branches missed.">                if (!isAngleAtBack(end)) {</span>

<span class="nc bnc" id="L617" title="All 2 branches missed.">                    if (extent &gt; -180.0) {  // the segment is entirely at the</span>
                                            // front of the chart
<span class="nc bnc" id="L619" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L620">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L621">                                    arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L622">                                    arc.getStartPoint().getX()</span>
<span class="nc" id="L623">                                    - arc.getEndPoint().getX(),</span>
<span class="nc" id="L624">                                    plotArea.getHeight()));</span>
<span class="nc" id="L625">                            side.intersect(front);</span>
<span class="nc" id="L626">                            g2.setPaint(paint);</span>
<span class="nc" id="L627">                            g2.fill(side);</span>
<span class="nc" id="L628">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L629">                            g2.draw(side);</span>
<span class="nc" id="L630">                        }</span>
                    }
                    else {  // the segment starts at the front, and wraps all
                            // the way around
                            // the back and finishes at the front again
<span class="nc" id="L635">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L636">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L637">                                arc.getStartPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L638">                                plotArea.getHeight()));</span>
<span class="nc" id="L639">                        side1.intersect(front);</span>

<span class="nc" id="L641">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L642">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L643">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="nc" id="L644">                                plotArea.getHeight()));</span>

<span class="nc" id="L646">                        side2.intersect(front);</span>
<span class="nc" id="L647">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L649">                            g2.fill(side1);</span>
<span class="nc" id="L650">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L653" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L654">                            g2.fill(back);</span>
                        }

<span class="nc" id="L657">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L659">                            g2.draw(side1);</span>
<span class="nc" id="L660">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L663" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L664">                            g2.draw(back);</span>
                        }

<span class="nc" id="L667">                    }</span>
                }
                else {  // starts at the front, finishes at the back (going
                        // around the left side)

<span class="fc bfc" id="L672" title="All 2 branches covered.">                    if (drawBack) {</span>
<span class="fc" id="L673">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L674">                                plotArea.getX(), plotArea.getY(),</span>
<span class="fc" id="L675">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="fc" id="L676">                                plotArea.getHeight()));</span>
<span class="fc" id="L677">                        side2.intersect(back);</span>
<span class="fc" id="L678">                        g2.setPaint(paint);</span>
<span class="fc" id="L679">                        g2.fill(side2);</span>
<span class="fc" id="L680">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L681">                        g2.draw(side2);</span>
                    }

<span class="fc bfc" id="L684" title="All 2 branches covered.">                    if (drawFront) {</span>
<span class="fc" id="L685">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L686">                                plotArea.getX(), plotArea.getY(),</span>
<span class="fc" id="L687">                                arc.getStartPoint().getX() - plotArea.getX(),</span>
<span class="fc" id="L688">                                plotArea.getHeight()));</span>
<span class="fc" id="L689">                        side1.intersect(front);</span>
<span class="fc" id="L690">                        g2.setPaint(paint);</span>
<span class="fc" id="L691">                        g2.fill(side1);</span>
<span class="fc" id="L692">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L693">                        g2.draw(side1);</span>
<span class="fc" id="L694">                    }</span>
                }
            }
            else {  // the segment starts at the back (still extending
                    // CLOCKWISE)

<span class="pc bpc" id="L700" title="1 of 2 branches missed.">                if (!isAngleAtFront(end)) {</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">                    if (extent &gt; -180.0) {  // whole segment stays at the back</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L703">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L704">                                    arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L705">                                    arc.getEndPoint().getX()</span>
<span class="nc" id="L706">                                    - arc.getStartPoint().getX(),</span>
<span class="nc" id="L707">                                    plotArea.getHeight()));</span>
<span class="nc" id="L708">                            side.intersect(back);</span>
<span class="nc" id="L709">                            g2.setPaint(paint);</span>
<span class="nc" id="L710">                            g2.fill(side);</span>
<span class="nc" id="L711">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L712">                            g2.draw(side);</span>
<span class="nc" id="L713">                        }</span>
                    }
                    else {  // starts at the back, wraps around front, and
                            // finishes at back again
<span class="nc" id="L717">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L718">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L719">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L720">                                plotArea.getHeight()));</span>
<span class="nc" id="L721">                        side1.intersect(back);</span>

<span class="nc" id="L723">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L724">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L725">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L726">                                plotArea.getHeight()));</span>

<span class="nc" id="L728">                        side2.intersect(back);</span>

<span class="nc" id="L730">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L732">                            g2.fill(side1);</span>
<span class="nc" id="L733">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L736" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L737">                            g2.fill(front);</span>
                        }

<span class="nc" id="L740">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L742">                            g2.draw(side1);</span>
<span class="nc" id="L743">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L746" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L747">                            g2.draw(front);</span>
                        }

<span class="nc" id="L750">                    }</span>
                }
                else {  // starts at back, finishes at front (CLOCKWISE)

<span class="fc bfc" id="L754" title="All 2 branches covered.">                    if (drawBack) {</span>
<span class="fc" id="L755">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L756">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="fc" id="L757">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="fc" id="L758">                                plotArea.getHeight()));</span>
<span class="fc" id="L759">                        side1.intersect(back);</span>
<span class="fc" id="L760">                        g2.setPaint(paint);</span>
<span class="fc" id="L761">                        g2.fill(side1);</span>
<span class="fc" id="L762">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L763">                        g2.draw(side1);</span>
                    }

<span class="fc bfc" id="L766" title="All 2 branches covered.">                    if (drawFront) {</span>
<span class="fc" id="L767">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L768">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="fc" id="L769">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="fc" id="L770">                                plotArea.getHeight()));</span>
<span class="fc" id="L771">                        side2.intersect(front);</span>
<span class="fc" id="L772">                        g2.setPaint(paint);</span>
<span class="fc" id="L773">                        g2.fill(side2);</span>
<span class="fc" id="L774">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L775">                        g2.draw(side2);</span>
<span class="fc" id="L776">                    }</span>

                }
            }
        }
<span class="nc bnc" id="L781" title="All 2 branches missed.">        else if (extent &gt; 0.0) {  // the pie sections are arranged ANTICLOCKWISE</span>

<span class="nc bnc" id="L783" title="All 2 branches missed.">            if (isAngleAtFront(start)) {  // segment starts at the front</span>

<span class="nc bnc" id="L785" title="All 2 branches missed.">                if (!isAngleAtBack(end)) {  // and finishes at the front</span>

<span class="nc bnc" id="L787" title="All 2 branches missed.">                    if (extent &lt; 180.0) {  // segment only occupies the front</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L789">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L790">                                    arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L791">                                    arc.getEndPoint().getX()</span>
<span class="nc" id="L792">                                    - arc.getStartPoint().getX(),</span>
<span class="nc" id="L793">                                    plotArea.getHeight()));</span>
<span class="nc" id="L794">                            side.intersect(front);</span>
<span class="nc" id="L795">                            g2.setPaint(paint);</span>
<span class="nc" id="L796">                            g2.fill(side);</span>
<span class="nc" id="L797">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L798">                            g2.draw(side);</span>
<span class="nc" id="L799">                        }</span>
                    }
                    else {  // segments wraps right around the back...
<span class="nc" id="L802">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L803">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L804">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L805">                                plotArea.getHeight()));</span>
<span class="nc" id="L806">                        side1.intersect(front);</span>

<span class="nc" id="L808">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L809">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L810">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L811">                                plotArea.getHeight()));</span>
<span class="nc" id="L812">                        side2.intersect(front);</span>

<span class="nc" id="L814">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L816">                            g2.fill(side1);</span>
<span class="nc" id="L817">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L820" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L821">                            g2.fill(back);</span>
                        }

<span class="nc" id="L824">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L826">                            g2.draw(side1);</span>
<span class="nc" id="L827">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L830" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L831">                            g2.draw(back);</span>
                        }

<span class="nc" id="L834">                    }</span>
                }
                else {  // segments starts at front and finishes at back...
<span class="nc bnc" id="L837" title="All 2 branches missed.">                    if (drawBack) {</span>
<span class="nc" id="L838">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L839">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L840">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="nc" id="L841">                                plotArea.getHeight()));</span>
<span class="nc" id="L842">                        side2.intersect(back);</span>
<span class="nc" id="L843">                        g2.setPaint(paint);</span>
<span class="nc" id="L844">                        g2.fill(side2);</span>
<span class="nc" id="L845">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L846">                        g2.draw(side2);</span>
                    }

<span class="nc bnc" id="L849" title="All 2 branches missed.">                    if (drawFront) {</span>
<span class="nc" id="L850">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L851">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L852">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L853">                                plotArea.getHeight()));</span>
<span class="nc" id="L854">                        side1.intersect(front);</span>
<span class="nc" id="L855">                        g2.setPaint(paint);</span>
<span class="nc" id="L856">                        g2.fill(side1);</span>
<span class="nc" id="L857">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L858">                        g2.draw(side1);</span>
<span class="nc" id="L859">                    }</span>
                }
            }
            else {  // segment starts at back

<span class="nc bnc" id="L864" title="All 2 branches missed.">                if (!isAngleAtFront(end)) {</span>
<span class="nc bnc" id="L865" title="All 2 branches missed.">                    if (extent &lt; 180.0) {  // and finishes at back</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L867">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L868">                                    arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L869">                                    arc.getStartPoint().getX()</span>
<span class="nc" id="L870">                                    - arc.getEndPoint().getX(),</span>
<span class="nc" id="L871">                                    plotArea.getHeight()));</span>
<span class="nc" id="L872">                            side.intersect(back);</span>
<span class="nc" id="L873">                            g2.setPaint(paint);</span>
<span class="nc" id="L874">                            g2.fill(side);</span>
<span class="nc" id="L875">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L876">                            g2.draw(side);</span>
<span class="nc" id="L877">                        }</span>
                    }
                    else {  // starts at back and wraps right around to the
                            // back again
<span class="nc" id="L881">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L882">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L883">                                plotArea.getX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L884">                                plotArea.getHeight()));</span>
<span class="nc" id="L885">                        side1.intersect(back);</span>

<span class="nc" id="L887">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L888">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L889">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="nc" id="L890">                                plotArea.getHeight()));</span>
<span class="nc" id="L891">                        side2.intersect(back);</span>

<span class="nc" id="L893">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L895">                            g2.fill(side1);</span>
<span class="nc" id="L896">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L899" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L900">                            g2.fill(front);</span>
                        }

<span class="nc" id="L903">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L905">                            g2.draw(side1);</span>
<span class="nc" id="L906">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L909" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L910">                            g2.draw(front);</span>
                        }

<span class="nc" id="L913">                    }</span>
                }
                else {  // starts at the back and finishes at the front
                        // (wrapping the left side)
<span class="nc bnc" id="L917" title="All 2 branches missed.">                    if (drawBack) {</span>
<span class="nc" id="L918">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L919">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L920">                                arc.getStartPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L921">                                plotArea.getHeight()));</span>
<span class="nc" id="L922">                        side1.intersect(back);</span>
<span class="nc" id="L923">                        g2.setPaint(paint);</span>
<span class="nc" id="L924">                        g2.fill(side1);</span>
<span class="nc" id="L925">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L926">                        g2.draw(side1);</span>
                    }

<span class="nc bnc" id="L929" title="All 2 branches missed.">                    if (drawFront) {</span>
<span class="nc" id="L930">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L931">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L932">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L933">                                plotArea.getHeight()));</span>
<span class="nc" id="L934">                        side2.intersect(front);</span>
<span class="nc" id="L935">                        g2.setPaint(paint);</span>
<span class="nc" id="L936">                        g2.fill(side2);</span>
<span class="nc" id="L937">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L938">                        g2.draw(side2);</span>
                    }
                }
            }

        }

<span class="fc" id="L945">    }</span>

    /**
     * Returns a short string describing the type of plot.
     *
     * @return &lt;i&gt;Pie 3D Plot&lt;/i&gt;.
     */
    @Override
    public String getPlotType() {
<span class="nc" id="L954">        return localizationResources.getString(&quot;Pie_3D_Plot&quot;);</span>
    }

    /**
     * A utility method that returns true if the angle represents a point at
     * the front of the 3D pie chart.  0 - 180 degrees is the back, 180 - 360
     * is the front.
     *
     * @param angle  the angle.
     *
     * @return A boolean.
     */
    private boolean isAngleAtFront(double angle) {
<span class="fc bfc" id="L967" title="All 2 branches covered.">        return (Math.sin(Math.toRadians(angle)) &lt; 0.0);</span>
    }

    /**
     * A utility method that returns true if the angle represents a point at
     * the back of the 3D pie chart.  0 - 180 degrees is the back, 180 - 360
     * is the front.
     *
     * @param angle  the angle.
     *
     * @return {@code true} if the angle is at the back of the pie.
     */
    private boolean isAngleAtBack(double angle) {
<span class="pc bpc" id="L980" title="1 of 2 branches missed.">        return (Math.sin(Math.toRadians(angle)) &gt; 0.0);</span>
    }

    /**
     * Tests this plot for equality with an arbitrary object.
     *
     * @param obj  the object ({@code null} permitted).
     *
     * @return A boolean.
     */
    @Override
    public boolean equals(Object obj) {
<span class="fc bfc" id="L992" title="All 2 branches covered.">        if (obj == this) {</span>
<span class="fc" id="L993">            return true;</span>
        }
<span class="pc bpc" id="L995" title="1 of 2 branches missed.">        if (!(obj instanceof PiePlot3D)) {</span>
<span class="nc" id="L996">            return false;</span>
        }
<span class="fc" id="L998">        PiePlot3D that = (PiePlot3D) obj;</span>
<span class="fc bfc" id="L999" title="All 2 branches covered.">        if (this.depthFactor != that.depthFactor) {</span>
<span class="fc" id="L1000">            return false;</span>
        }
<span class="fc bfc" id="L1002" title="All 2 branches covered.">        if (this.darkerSides != that.darkerSides) {</span>
<span class="fc" id="L1003">            return false;</span>
        }
<span class="fc" id="L1005">        return super.equals(obj);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>