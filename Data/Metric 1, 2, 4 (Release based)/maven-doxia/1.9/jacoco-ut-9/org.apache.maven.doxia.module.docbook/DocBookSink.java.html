<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DocBookSink.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Doxia :: Simplified DocBook Module</a> &gt; <a href="index.source.html" class="el_package">org.apache.maven.doxia.module.docbook</a> &gt; <span class="el_source">DocBookSink.java</span></div><h1>DocBookSink.java</h1><pre class="source lang-java linenums">package org.apache.maven.doxia.module.docbook;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import java.io.PrintWriter;
import java.io.StringWriter;
import java.io.Writer;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.Stack;
import java.util.StringTokenizer;
import java.util.TreeSet;

import javax.swing.text.MutableAttributeSet;
import javax.swing.text.SimpleAttributeSet;

import org.apache.maven.doxia.sink.Sink;
import org.apache.maven.doxia.sink.SinkEventAttributes;
import org.apache.maven.doxia.sink.impl.AbstractXmlSink;
import org.apache.maven.doxia.sink.impl.SinkEventAttributeSet;
import org.apache.maven.doxia.util.DoxiaUtils;
import org.codehaus.plexus.util.FileUtils;

import static org.apache.maven.doxia.util.HtmlTools.escapeHTML;

/**
 * &lt;a href=&quot;http://www.oasis-open.org/docbook&quot;&gt;Docbook&lt;/a&gt; Sink implementation.
 * &lt;br&gt;
 * It uses the Docbook v4.4 DTD &lt;a href=&quot;http://www.oasis-open.org/docbook/sgml/4.4/docbookx.dtd&quot;&gt;
 * http://www.oasis-open.org/docbook/sgml/4.4/docbookx.dtd&lt;/a&gt;.
 *
 * @version $Id$
 * @since 1.0
 */
public class DocBookSink
    extends AbstractXmlSink
    implements DocbookMarkup, SimplifiedDocbookMarkup
{
    /** DocBook V4.4 SGML public id: &quot;-//OASIS//DTD DocBook V4.4//EN&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_SGML_PUBLIC_ID} instead of. */
    public static final String DEFAULT_SGML_PUBLIC_ID = DocbookMarkup.DEFAULT_SGML_PUBLIC_ID;

    /** DocBook XML V4.4 XML public id: &quot;-//OASIS//DTD DocBook XML V4.4//EN&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_XML_PUBLIC_ID} instead of. */
    public static final String DEFAULT_XML_PUBLIC_ID = DocbookMarkup.DEFAULT_XML_PUBLIC_ID;

    /** DocBook XML V4.4 XML system id: &quot;http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_XML_SYSTEM_ID} instead of. */
    public static final String DEFAULT_XML_SYSTEM_ID = DocbookMarkup.DEFAULT_XML_SYSTEM_ID;

    /** DocBook XML V4.4 SGML system id: &quot;http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_SGML_SYSTEM_ID} instead of. */
    public static final String DEFAULT_SGML_SYSTEM_ID = DocbookMarkup.DEFAULT_SGML_SYSTEM_ID;

    /** The output writer. */
    private PrintWriter out;

    /** xmlMode. */
<span class="fc" id="L80">    private boolean xmlMode = false;</span>

    /** styleSheet. */
<span class="fc" id="L83">    private String styleSheet = null;</span>

    /** language. */
<span class="fc" id="L86">    private String lang = null;</span>

    /** publicId. */
<span class="fc" id="L89">    private String publicId = null;</span>

    /** systemId. */
<span class="fc" id="L92">    private String systemId = null;</span>

    /** italicBegin. */
    private String italicBeginTag;

    /** italicEnd. */
    private String italicEndTag;

    /** boldBegin. */
    private String boldBeginTag;

    /** boldEnd. */
    private String boldEndTag;

    /** monospacedBegin. */
    private String monospacedBeginTag;

    /** monospacedEnd. */
    private String monospacedEndTag;

    /** horizontalRule. */
    private String horizontalRuleElement;

    /** pageBreak. */
    private String pageBreakElement;

    /** lineBreak. */
    private String lineBreakElement;

    /** An image source file. */
    private String graphicsFileName;

    /** hasTitle. */
    private boolean hasTitle;

    /** authorDate. */
    private boolean authorDateFlag;

    /** verbatim. */
    private boolean verbatimFlag;

    /** externalLink. */
    private boolean externalLinkFlag;

    /** tableHasCaption. */
    private boolean tableHasCaption;

    /** Used for table rows. */
    private PrintWriter savedOut;

    /** tableRows. */
    private String tableRows;

    /** tableRows writer. */
    private StringWriter tableRowsWriter;

    /** tableHasGrid. */
    private boolean tableHasGrid;

    private boolean skip;

    private boolean paragraph;

    private String encoding;

    /** Keep track of the closing tags for inline events. */
<span class="fc" id="L158">    protected Stack&lt;List&lt;String&gt;&gt; inlineStack = new Stack&lt;&gt;();</span>

    /** Map of warn messages with a String as key to describe the error type and a Set as value.
     * Using to reduce warn messages. */
    private Map&lt;String, Set&lt;String&gt;&gt; warnMessages;

    /**
     * Constructor, initialize the Writer.
     *
     * @param writer not null writer to write the result. &lt;b&gt;Should&lt;/b&gt; be an UTF-8 Writer.
     * You could use &lt;code&gt;newXmlWriter&lt;/code&gt; methods from {@link org.codehaus.plexus.util.WriterFactory}.
     */
    protected DocBookSink( Writer writer )
    {
<span class="fc" id="L172">        this( writer, null );</span>
<span class="fc" id="L173">    }</span>

    /**
     * Constructor, initialize the Writer and tells which encoding is used.
     *
     * @param writer not null writer to write the result.
     * @param encoding the encoding used, that should be written to the generated HTML content
     * if not &lt;code&gt;null&lt;/code&gt;.
     */
    protected DocBookSink( Writer writer, String encoding )
<span class="fc" id="L183">    {</span>
<span class="fc" id="L184">        this.out = new PrintWriter( writer );</span>
<span class="fc" id="L185">        this.encoding = encoding;</span>

<span class="fc" id="L187">        setItalicElement( &quot;&lt;emphasis&gt;&quot; );</span>
<span class="fc" id="L188">        setBoldElement( &quot;&lt;emphasis role=\&quot;bold\&quot;&gt;&quot; );</span>
<span class="fc" id="L189">        setMonospacedElement( &quot;&lt;literal&gt;&quot; );</span>
<span class="fc" id="L190">        setHorizontalRuleElement( &quot;&lt;!-- HR --&gt;&quot; );</span>
<span class="fc" id="L191">        setPageBreakElement( &quot;&lt;!-- PB --&gt;&quot; );</span>
<span class="fc" id="L192">        setLineBreakElement( &quot;&lt;!-- LB --&gt;&quot; );</span>
<span class="fc" id="L193">    }</span>

    /**
     * Constructor, initialize the Writer and tells which encoding and languageId are used.
     *
     * @param writer not null writer to write the result.
     * @param encoding the encoding used, that should be written to the generated HTML content
     * if not &lt;code&gt;null&lt;/code&gt;.
     * @param languageId language identifier for the root element as defined by
     * &lt;a href=&quot;ftp://ftp.isi.edu/in-notes/bcp/bcp47.txt&quot;&gt;IETF BCP 47&lt;/a&gt;, Tags for the Identification of Languages;
     * in addition, the empty string may be specified.
     * @since 1.1
     */
    protected DocBookSink( Writer writer, String encoding, String languageId )
    {
<span class="nc" id="L208">        this( writer, encoding );</span>

<span class="nc" id="L210">        this.lang = languageId;</span>
<span class="nc" id="L211">    }</span>

    /**
     * &lt;p&gt;escapeSGML&lt;/p&gt;
     *
     * @param text The text to escape.
     * @param xmlMode xmlMode.
     * @return The escaped text.
     * @deprecated Use HtmlTools#escapeHTML(String,boolean).
     */
    public static String escapeSGML( String text, boolean xmlMode )
    {
<span class="nc" id="L223">        return escapeHTML( text, xmlMode );</span>
    }

    /**
     * Sets the xml mode.
     *
     * @param mode the mode to set.
     * @deprecated xml mode is not used.
     */
    public void setXMLMode( boolean mode )
    {
<span class="nc" id="L234">        this.xmlMode = mode;</span>
<span class="nc" id="L235">    }</span>

    /**
     * Returns the current xmlMode.
     *
     * @return the current xmlMode.
     * @deprecated xml mode is not used.
     */
    public boolean isXMLMode()
    {
<span class="nc" id="L245">        return xmlMode;</span>
    }

    /**
     * Sets the encoding. The encoding specified here must be consistent with then encoding
     * used in the Writer used by this DocBookSink instance.
     *
     * @param enc the encoding to set.
     */
    public void setEncoding( String enc )
    {
<span class="nc" id="L256">        encoding = enc;</span>
<span class="nc" id="L257">    }</span>

    /**
     * Returns the encoding.
     *
     * @return the encoding set (can be &lt;code&gt;null&lt;/code&gt;).
     */
    public String getEncoding()
    {
<span class="nc" id="L266">        return encoding;</span>
    }

    /**
     * Sets the styleSheet.
     *
     * @param sheet the styleSheet to set.
     */
    public void setStyleSheet( String sheet )
    {
<span class="nc" id="L276">        this.styleSheet = sheet;</span>
<span class="nc" id="L277">    }</span>

    /**
     * Returns the current styleSheet.
     *
     * @return the current styleSheet.
     */
    public String getStyleSheet()
    {
<span class="nc" id="L286">        return styleSheet;</span>
    }

    /**
     * Sets the publicId.
     *
     * @param id the publicId to set.
     */
    public void setPublicId( String id )
    {
<span class="nc" id="L296">        this.publicId = id;</span>
<span class="nc" id="L297">    }</span>

    /**
     * Returns the current publicId.
     *
     * @return the current publicId.
     */
    public String getPublicId()
    {
<span class="nc" id="L306">        return publicId;</span>
    }

    /**
     * Sets the systemId.
     *
     * @param id the systemId to set.
     */
    public void setSystemId( String id )
    {
<span class="nc" id="L316">        this.systemId = id;</span>
<span class="nc" id="L317">    }</span>

    /**
     * Returns the current systemId.
     *
     * @return the current systemId.
     */
    public String getSystemId()
    {
<span class="nc" id="L326">        return systemId;</span>
    }

    /**
     * Sets the language.
     *
     * @param language the language to set.
     */
    public void setLanguage( String language )
    {
<span class="nc" id="L336">        this.lang = language;</span>
<span class="nc" id="L337">    }</span>

    /**
     * Returns the current language.
     *
     * @return the current language.
     */
    public String getLanguage()
    {
<span class="nc" id="L346">        return lang;</span>
    }

    /**
     * Sets the current italicBeginTag and constructs the corresponding end tag from it.
     *
     * @param tag the tag to set. If tag is null, the empty string is used.
     */
    public void setItalicElement( String tag )
    {
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">        if ( tag == null )</span>
        {
<span class="nc" id="L358">            tag = &quot;&quot;;</span>
        }
<span class="fc" id="L360">        this.italicBeginTag = tag;</span>
<span class="fc" id="L361">        italicEndTag = makeEndTag( italicBeginTag );</span>
<span class="fc" id="L362">    }</span>

    /**
     * Constructs the corresponding end tag from the given begin tag.
     *
     * @param beginTag the begin tag to set. If null, the empty string is returned.
     * @return the corresponding end tag.
     */
    private String makeEndTag( String beginTag )
    {
<span class="fc" id="L372">        int length = beginTag.length();</span>
<span class="pc bpc" id="L373" title="1 of 2 branches missed.">        if ( length == 0 )</span>
        {
<span class="nc" id="L375">            return &quot;&quot;;</span>
        }

<span class="pc bpc" id="L378" title="2 of 4 branches missed.">        if ( beginTag.charAt( 0 ) != '&lt;' || beginTag.charAt( length - 1 ) != '&gt;' )</span>
        {
<span class="nc" id="L380">            throw new IllegalArgumentException( &quot;'&quot; + beginTag + &quot;', not a tag&quot; );</span>
        }

<span class="fc" id="L383">        StringTokenizer tokens = new StringTokenizer( beginTag, &quot;&lt;&gt; \t\n\r\f&quot; );</span>
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">        if ( !tokens.hasMoreTokens() )</span>
        {
<span class="nc" id="L386">            throw new IllegalArgumentException( &quot;'&quot; + beginTag + &quot;', invalid tag&quot; );</span>
        }

<span class="fc" id="L389">        return &quot;&lt;/&quot; + tokens.nextToken() + &quot;&gt;&quot;;</span>
    }

    /**
     * Returns the current italicBeginTag.
     *
     * @return the current italicBeginTag. Defaults to {@code &lt;emphasis&gt;}.
     */
    public String getItalicElement()
    {
<span class="nc" id="L399">        return italicBeginTag;</span>
    }

    /**
     * Sets the current boldBeginTag and constructs the corresponding end tag from it.
     *
     * @param tag the tag to set. If tag is null, the empty string is used.
     */
    public void setBoldElement( String tag )
    {
<span class="pc bpc" id="L409" title="1 of 2 branches missed.">        if ( tag == null )</span>
        {
<span class="nc" id="L411">            tag = &quot;&quot;;</span>
        }
<span class="fc" id="L413">        this.boldBeginTag = tag;</span>
<span class="fc" id="L414">        boldEndTag = makeEndTag( boldBeginTag );</span>
<span class="fc" id="L415">    }</span>

    /**
     * Returns the current boldBeginTag.
     *
     * @return the current boldBeginTag. Defaults to {@code &lt;emphasis role=\&quot;bold\&quot;&gt;}.
     */
    public String getBoldElement()
    {
<span class="nc" id="L424">        return boldBeginTag;</span>
    }

    /**
     * Sets the current monospacedBeginTag and constructs the corresponding end tag from it.
     *
     * @param tag the tag to set. If tag is null, the empty string is used.
     */
    public void setMonospacedElement( String tag )
    {
<span class="pc bpc" id="L434" title="1 of 2 branches missed.">        if ( tag == null )</span>
        {
<span class="nc" id="L436">            tag = &quot;&quot;;</span>
        }
<span class="fc" id="L438">        this.monospacedBeginTag = tag;</span>
<span class="fc" id="L439">        monospacedEndTag = makeEndTag( monospacedBeginTag );</span>
<span class="fc" id="L440">    }</span>

    /**
     * Returns the current monospacedBeginTag.
     *
     * @return the current monospacedBeginTag. Defaults to {@code &lt;literal&gt;}.
     */
    public String getMonospacedElement()
    {
<span class="nc" id="L449">        return monospacedBeginTag;</span>
    }

    /**
     * Sets the current horizontalRuleElement.
     *
     * @param element the element to set.
     */
    public void setHorizontalRuleElement( String element )
    {
<span class="fc" id="L459">        this.horizontalRuleElement = element;</span>
<span class="fc" id="L460">    }</span>

    /**
     * Returns the current horizontalRuleElement.
     *
     * @return the current horizontalRuleElement. Defaults to &quot;&lt;!-- HR --&gt;&quot;.
     */
    public String getHorizontalRuleElement()
    {
<span class="nc" id="L469">        return horizontalRuleElement;</span>
    }

    /**
     * Sets the current pageBreakElement.
     *
     * @param element the element to set.
     */
    public void setPageBreakElement( String element )
    {
<span class="fc" id="L479">        this.pageBreakElement = element;</span>
<span class="fc" id="L480">    }</span>

    /**
     * Returns the current pageBreakElement.
     *
     * @return the current pageBreakElement. Defaults to &quot;&lt;!-- PB --&gt;&quot;.
     */
    public String getPageBreakElement()
    {
<span class="nc" id="L489">        return pageBreakElement;</span>
    }

    /**
     * Sets the current lineBreakElement.
     *
     * @param element the element to set.
     */
    public void setLineBreakElement( String element )
    {
<span class="fc" id="L499">        this.lineBreakElement = element;</span>
<span class="fc" id="L500">    }</span>

    /**
     * Returns the current lineBreakElement.
     *
     * @return the current lineBreakElement. Defaults to &quot;&lt;!-- LB --&gt;&quot;.
     */
    public String getLineBreakElement()
    {
<span class="nc" id="L509">        return lineBreakElement;</span>
    }

    /**
     * Reset all variables.
     *
     * @deprecated since 1.1.2, use {@link #init()} instead of.
     */
    protected void resetState()
    {
<span class="nc" id="L519">       init();</span>
<span class="nc" id="L520">    }</span>

    /** {@inheritDoc} */
    protected void init()
    {
<span class="fc" id="L525">        hasTitle = false;</span>
<span class="fc" id="L526">        authorDateFlag = false;</span>
<span class="fc" id="L527">        verbatimFlag = false;</span>
<span class="fc" id="L528">        externalLinkFlag = false;</span>
<span class="fc" id="L529">        graphicsFileName = null;</span>
<span class="fc" id="L530">        tableHasCaption = false;</span>
<span class="fc" id="L531">        savedOut = null;</span>
<span class="fc" id="L532">        tableRows = null;</span>
<span class="fc" id="L533">        tableHasGrid = false;</span>
<span class="fc" id="L534">    }</span>

    // ----------------------------------------------------------------------
    //
    // ----------------------------------------------------------------------

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_PUBLIC_ID
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_SYSTEM_ID
     * @see SimplifiedDocbookMarkup#ARTICLE_TAG
     */
    public void head()
    {
<span class="fc" id="L548">        init();</span>

<span class="fc" id="L550">        MutableAttributeSet att = writeXmlHeader( &quot;article&quot; );</span>

<span class="fc" id="L552">        writeStartTag( SimplifiedDocbookMarkup.ARTICLE_TAG, att );</span>
<span class="fc" id="L553">    }</span>

    /**
     * writeXmlHeader.
     *
     * @param root not null.
     * @return an attribute set.
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_PUBLIC_ID
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_SYSTEM_ID
     * @see SimplifiedDocbookMarkup#ARTICLE_TAG
     * @since 1.1
     */
    protected MutableAttributeSet writeXmlHeader( String root )
    {
<span class="fc" id="L567">        markup( &quot;&lt;?xml version=\&quot;1.0\&quot;&quot; );</span>
<span class="fc bfc" id="L568" title="All 2 branches covered.">        if ( encoding != null )</span>
        {
<span class="fc" id="L570">            markup( &quot; encoding=\&quot;&quot; + encoding + &quot;\&quot;&quot; );</span>
        }
<span class="fc" id="L572">        markup( &quot;?&gt;&quot; );</span>

<span class="pc bpc" id="L574" title="1 of 2 branches missed.">        if ( styleSheet != null )</span>
        {
<span class="nc" id="L576">            markup( &quot;&lt;?xml-stylesheet type=\&quot;text/css\&quot; href=\&quot;&quot; + styleSheet + &quot;\&quot; ?&gt;&quot; );</span>
        }

        String pubId;
<span class="fc" id="L580">        markup( &quot;&lt;!DOCTYPE &quot; + root + &quot; PUBLIC&quot; );</span>

<span class="pc bpc" id="L582" title="1 of 2 branches missed.">        if ( publicId == null )</span>
        {
<span class="fc" id="L584">            pubId = SimplifiedDocbookMarkup.DEFAULT_XML_PUBLIC_ID;</span>
        }
        else
        {
<span class="nc" id="L588">            pubId = publicId;</span>
        }
<span class="fc" id="L590">        markup( &quot; \&quot;&quot; + pubId + &quot;\&quot;&quot; );</span>
<span class="fc" id="L591">        String sysId = systemId;</span>
<span class="pc bpc" id="L592" title="1 of 2 branches missed.">        if ( sysId == null )</span>
        {
<span class="fc" id="L594">                sysId = SimplifiedDocbookMarkup.DEFAULT_XML_SYSTEM_ID;</span>
        }
<span class="fc" id="L596">        markup( &quot; \&quot;&quot; + sysId + &quot;\&quot;&gt;&quot; );</span>

<span class="fc" id="L598">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="pc bpc" id="L599" title="1 of 2 branches missed.">        if ( lang != null )</span>
        {
<span class="nc" id="L601">            att.addAttribute( LANG_ATTRIBUTE, lang );</span>
        }
<span class="fc" id="L603">        return att;</span>
    }

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ARTICLEINFO_TAG
     */
    public void head_()
    {
<span class="fc bfc" id="L612" title="All 2 branches covered.">        if ( hasTitle )</span>
        {
<span class="fc" id="L614">            writeEndTag( SimplifiedDocbookMarkup.ARTICLEINFO_TAG );</span>
<span class="fc" id="L615">            hasTitle = false;</span>
        }
<span class="fc" id="L617">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ARTICLEINFO_TAG
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void title()
    {
<span class="fc" id="L626">        writeStartTag( SimplifiedDocbookMarkup.ARTICLEINFO_TAG );</span>
<span class="fc" id="L627">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L628">        hasTitle = true;</span>
<span class="fc" id="L629">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void title_()
    {
<span class="fc" id="L637">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L638">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#CORPAUTHOR_TAG
     */
    public void author()
    {
<span class="fc" id="L646">        authorDateFlag = true;</span>
<span class="fc" id="L647">        writeStartTag( SimplifiedDocbookMarkup.CORPAUTHOR_TAG );</span>
<span class="fc" id="L648">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#CORPAUTHOR_TAG
     */
    public void author_()
    {
<span class="fc" id="L656">        writeEndTag( SimplifiedDocbookMarkup.CORPAUTHOR_TAG );</span>
<span class="fc" id="L657">        authorDateFlag = false;</span>
<span class="fc" id="L658">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#DATE_TAG
     */
    public void date()
    {
<span class="fc" id="L666">        authorDateFlag = true;</span>
<span class="fc" id="L667">        writeStartTag( SimplifiedDocbookMarkup.DATE_TAG );</span>
<span class="fc" id="L668">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#DATE_TAG
     */
    public void date_()
    {
<span class="fc" id="L676">        writeEndTag( SimplifiedDocbookMarkup.DATE_TAG );</span>
<span class="fc" id="L677">        authorDateFlag = false;</span>
<span class="fc" id="L678">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ARTICLE_TAG
     */
    public void body_()
    {
<span class="fc" id="L686">        writeEndTag( SimplifiedDocbookMarkup.ARTICLE_TAG );</span>
<span class="fc" id="L687">        out.flush();</span>
<span class="fc" id="L688">        init();</span>
<span class="fc" id="L689">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SIDEBAR_TAG
     */
    public void sidebar()
    {
<span class="fc" id="L697">        writeStartTag( SimplifiedDocbookMarkup.SIDEBAR_TAG );</span>
<span class="fc" id="L698">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SIDEBAR_TAG
     */
    public void sidebar_()
    {
<span class="fc" id="L706">        writeEndTag( SimplifiedDocbookMarkup.SIDEBAR_TAG );</span>
<span class="fc" id="L707">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section1()
    {
<span class="fc" id="L715">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L716">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section1_()
    {
<span class="fc" id="L724">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L725">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section2()
    {
<span class="fc" id="L733">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L734">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section2_()
    {
<span class="fc" id="L742">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L743">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section3()
    {
<span class="fc" id="L751">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L752">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section3_()
    {
<span class="fc" id="L760">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L761">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section4()
    {
<span class="fc" id="L769">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L770">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section4_()
    {
<span class="fc" id="L778">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L779">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section5()
    {
<span class="fc" id="L787">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L788">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section5_()
    {
<span class="fc" id="L796">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L797">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle()
    {
<span class="fc" id="L805">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L806">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle_()
    {
<span class="fc" id="L814">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L815">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle1()
    {
<span class="fc" id="L823">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L824">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle1_()
    {
<span class="fc" id="L832">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L833">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle2()
    {
<span class="fc" id="L841">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L842">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle2_()
    {
<span class="fc" id="L850">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L851">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle3()
    {
<span class="fc" id="L859">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L860">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle3_()
    {
<span class="fc" id="L868">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L869">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle4()
    {
<span class="fc" id="L877">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L878">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle4_()
    {
<span class="fc" id="L886">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L887">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle5()
    {
<span class="fc" id="L895">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L896">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle5_()
    {
<span class="fc" id="L904">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L905">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTIONINFO_TAG
     */
    public void header()
    {
<span class="fc" id="L913">        writeStartTag( SimplifiedDocbookMarkup.SECTIONINFO_TAG );</span>
<span class="fc" id="L914">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTIONINFO_TAG
     */
    public void header_()
    {
<span class="fc" id="L922">        writeEndTag( SimplifiedDocbookMarkup.SECTIONINFO_TAG );</span>
<span class="fc" id="L923">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ITEMIZEDLIST_TAG
     */
    public void list()
    {
<span class="fc" id="L931">        paragraph_();</span>
<span class="fc" id="L932">        writeStartTag( SimplifiedDocbookMarkup.ITEMIZEDLIST_TAG );</span>
<span class="fc" id="L933">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ITEMIZEDLIST_TAG
     */
    public void list_()
    {
<span class="fc" id="L941">        writeEndTag( SimplifiedDocbookMarkup.ITEMIZEDLIST_TAG );</span>
<span class="fc" id="L942">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void listItem()
    {
<span class="fc" id="L950">        writeStartTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L951">        paragraph();</span>
<span class="fc" id="L952">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void listItem_()
    {
<span class="fc" id="L960">        paragraph_();</span>
<span class="fc" id="L961">        writeEndTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L962">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ORDEREDLIST_TAG
     * @see SimplifiedDocbookMarkup#NUMERATION_ATTRIBUTE
     */
    public void numberedList( int numbering )
    {
<span class="fc" id="L971">        String numeration = DocbookUtils.docbookListNumbering( numbering );</span>

<span class="fc" id="L973">        paragraph_();</span>

<span class="fc" id="L975">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L976">        att.addAttribute( SimplifiedDocbookMarkup.NUMERATION_ATTRIBUTE, numeration );</span>

<span class="fc" id="L978">        writeStartTag( SimplifiedDocbookMarkup.ORDEREDLIST_TAG, att );</span>
<span class="fc" id="L979">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ORDEREDLIST_TAG
     */
    public void numberedList_()
    {
<span class="fc" id="L987">        writeEndTag( SimplifiedDocbookMarkup.ORDEREDLIST_TAG );</span>
<span class="fc" id="L988">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void numberedListItem()
    {
<span class="fc" id="L996">        writeStartTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L997">        paragraph();</span>
<span class="fc" id="L998">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void numberedListItem_()
    {
<span class="fc" id="L1006">        paragraph_();</span>
<span class="fc" id="L1007">        writeEndTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L1008">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARIABLELIST_TAG
     */
    public void definitionList()
    {
<span class="fc" id="L1016">        paragraph_();</span>
<span class="fc" id="L1017">        writeStartTag( SimplifiedDocbookMarkup.VARIABLELIST_TAG );</span>
<span class="fc" id="L1018">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARIABLELIST_TAG
     */
    public void definitionList_()
    {
<span class="fc" id="L1026">        writeEndTag( SimplifiedDocbookMarkup.VARIABLELIST_TAG );</span>
<span class="fc" id="L1027">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARLISTENTRY_TAG
     */
    public void definitionListItem()
    {
<span class="fc" id="L1035">        writeStartTag( SimplifiedDocbookMarkup.VARLISTENTRY_TAG );</span>
<span class="fc" id="L1036">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARLISTENTRY_TAG
     */
    public void definitionListItem_()
    {
<span class="fc" id="L1044">        writeEndTag( SimplifiedDocbookMarkup.VARLISTENTRY_TAG );</span>
<span class="fc" id="L1045">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TERM_TAG
     */
    public void definedTerm()
    {
<span class="fc" id="L1053">        writeStartTag( SimplifiedDocbookMarkup.TERM_TAG );</span>
<span class="fc" id="L1054">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TERM_TAG
     */
    public void definedTerm_()
    {
<span class="fc" id="L1062">        writeEndTag( SimplifiedDocbookMarkup.TERM_TAG );</span>
<span class="fc" id="L1063">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void definition()
    {
<span class="fc" id="L1071">        writeStartTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L1072">        paragraph();</span>
<span class="fc" id="L1073">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void definition_()
    {
<span class="fc" id="L1081">        paragraph_();</span>
<span class="fc" id="L1082">        writeEndTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L1083">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PARA_TAG
     */
    public void paragraph()
    {
<span class="fc bfc" id="L1091" title="All 2 branches covered.">        if ( !paragraph )</span>
        {
<span class="fc" id="L1093">            writeStartTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1094">            paragraph = true;</span>
        }
<span class="fc" id="L1096">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PARA_TAG
     */
    public void paragraph_()
    {
<span class="fc bfc" id="L1104" title="All 2 branches covered.">        if ( paragraph )</span>
        {
<span class="fc" id="L1106">            writeEndTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1107">            paragraph = false;</span>
        }
<span class="fc" id="L1109">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PROGRAMLISTING_TAG
     */
    public void verbatim( boolean boxed )
    {
<span class="fc" id="L1117">        verbatimFlag = true;</span>
<span class="fc" id="L1118">        paragraph_();</span>
<span class="fc" id="L1119">        writeStartTag( SimplifiedDocbookMarkup.PROGRAMLISTING_TAG );</span>
<span class="fc" id="L1120">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PROGRAMLISTING_TAG
     */
    public void verbatim_()
    {
<span class="fc" id="L1128">        writeEndTag( SimplifiedDocbookMarkup.PROGRAMLISTING_TAG );</span>
<span class="fc" id="L1129">        verbatimFlag = false;</span>
<span class="fc" id="L1130">    }</span>

    /** {@inheritDoc} */
    public void horizontalRule()
    {
<span class="fc" id="L1135">        markup( horizontalRuleElement );</span>
<span class="fc" id="L1136">    }</span>

    /** {@inheritDoc} */
    public void pageBreak()
    {
<span class="fc" id="L1141">        markup( pageBreakElement );</span>
<span class="fc" id="L1142">    }</span>

    /** {@inheritDoc} */
    public void figure()
    {
<span class="fc" id="L1147">        writeStartTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="fc" id="L1148">    }</span>

    /** {@inheritDoc} */
    public void figure_()
    {
<span class="fc" id="L1153">        writeEndTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="fc" id="L1154">    }</span>

    /**
     * &lt;p&gt;graphicElement&lt;/p&gt;
     *
     * @see SimplifiedDocbookMarkup#MEDIAOBJECT_TAG
     * @see SimplifiedDocbookMarkup#IMAGEOBJECT_TAG
     * @see SimplifiedDocbookMarkup#IMAGEDATA_TAG
     * @see SimplifiedDocbookMarkup#FORMAT_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#FILEREF_ATTRIBUTE
     * @deprecated do not use!
     */
    protected void graphicElement()
    {
<span class="nc bnc" id="L1168" title="All 2 branches missed.">        if ( graphicsFileName != null )</span>
        {
<span class="nc" id="L1170">            String format = FileUtils.extension( graphicsFileName ).toUpperCase( Locale.ENGLISH );</span>
<span class="nc bnc" id="L1171" title="All 2 branches missed.">            if ( format.length() == 0 )</span>
            {
<span class="nc" id="L1173">                format = &quot;JPEG&quot;;</span>
            }

<span class="nc" id="L1176">            writeStartTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="nc" id="L1177">            writeStartTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>

<span class="nc" id="L1179">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="nc" id="L1180">            att.addAttribute( SimplifiedDocbookMarkup.FORMAT_ATTRIBUTE, escapeHTML( format, true ) );</span>
<span class="nc" id="L1181">            att.addAttribute( SimplifiedDocbookMarkup.FILEREF_ATTRIBUTE, escapeHTML( graphicsFileName, true ) );</span>

<span class="nc" id="L1183">            writeSimpleTag( SimplifiedDocbookMarkup.IMAGEDATA_TAG, att );</span>

<span class="nc" id="L1185">            writeEndTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>
<span class="nc" id="L1186">            writeEndTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="nc" id="L1187">            graphicsFileName = null;</span>
        }
<span class="nc" id="L1189">    }</span>

    /** {@inheritDoc} */
    public void figureGraphics( String name )
    {
<span class="fc" id="L1194">        String format = FileUtils.extension( name ).toUpperCase( Locale.ENGLISH );</span>

<span class="fc" id="L1196">        writeStartTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>

<span class="fc" id="L1198">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1199">        att.addAttribute( SimplifiedDocbookMarkup.FORMAT_ATTRIBUTE, escapeHTML( format, true ) );</span>
<span class="fc" id="L1200">        att.addAttribute( SimplifiedDocbookMarkup.FILEREF_ATTRIBUTE, escapeHTML( name, true ) );</span>

<span class="fc" id="L1202">        writeSimpleTag( SimplifiedDocbookMarkup.IMAGEDATA_TAG, att );</span>

<span class="fc" id="L1204">        writeEndTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>
<span class="fc" id="L1205">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#FIGURE_TAG
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void figureCaption()
    {
<span class="fc" id="L1214">        writeStartTag( SimplifiedDocbookMarkup.CAPTION_TAG );</span>
<span class="fc" id="L1215">        writeStartTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1216">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#FIGURE_TAG
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void figureCaption_()
    {
<span class="fc" id="L1225">        writeEndTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1226">        writeEndTag( SimplifiedDocbookMarkup.CAPTION_TAG );</span>
<span class="fc" id="L1227">    }</span>

    /** {@inheritDoc} */
    public void table()
    {
<span class="fc" id="L1232">        tableHasCaption = false;</span>
<span class="fc" id="L1233">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#INFORMALTABLE_TAG
     * @see SimplifiedDocbookMarkup#FRAME_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#ROWSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#COLSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#TABLE_TAG
     */
    public void table_()
    {
<span class="fc bfc" id="L1245" title="All 2 branches covered.">        if ( tableHasCaption )</span>
        {
<span class="fc" id="L1247">            tableHasCaption = false;</span>
            // Formal table+title already written to original destination ---

<span class="fc" id="L1250">            out.write( tableRows  );</span>
<span class="fc" id="L1251">            writeEndTag( TABLE_TAG );</span>
        }
        else
        {
<span class="fc" id="L1255">            String frame = &quot;none&quot;;</span>
<span class="fc" id="L1256">            String sep = &quot;0&quot;;</span>
<span class="fc bfc" id="L1257" title="All 2 branches covered.">            if ( tableHasGrid )</span>
            {
<span class="fc" id="L1259">                frame = &quot;all&quot;;</span>
<span class="fc" id="L1260">                sep = &quot;1&quot;;</span>
            }

<span class="fc" id="L1263">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1264">            att.addAttribute( SimplifiedDocbookMarkup.FRAME_ATTRIBUTE, frame );</span>
<span class="fc" id="L1265">            att.addAttribute( SimplifiedDocbookMarkup.ROWSEP_ATTRIBUTE, sep );</span>
<span class="fc" id="L1266">            att.addAttribute( SimplifiedDocbookMarkup.COLSEP_ATTRIBUTE, sep );</span>

<span class="fc" id="L1268">            writeStartTag( SimplifiedDocbookMarkup.INFORMALTABLE_TAG, att );</span>

<span class="fc" id="L1270">            out.write( tableRows  );</span>

<span class="fc" id="L1272">            writeEndTag( SimplifiedDocbookMarkup.INFORMALTABLE_TAG );</span>
        }

<span class="fc" id="L1275">        tableRows = null;</span>
<span class="fc" id="L1276">        tableHasGrid = false;</span>
<span class="fc" id="L1277">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TGROUP_TAG
     * @see SimplifiedDocbookMarkup#COLS_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#COLSPEC_TAG
     */
    public void tableRows( int[] justification, boolean grid )
    {
<span class="fc" id="L1287">        tableHasGrid = grid;</span>

        // Divert output to a string ---
<span class="fc" id="L1290">        out.flush();</span>
<span class="fc" id="L1291">        savedOut = out;</span>
<span class="fc" id="L1292">        tableRowsWriter = new StringWriter();</span>
<span class="fc" id="L1293">        out = new PrintWriter( tableRowsWriter );</span>

<span class="fc" id="L1295">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1296">        att.addAttribute( SimplifiedDocbookMarkup.COLS_ATTRIBUTE, String.valueOf( justification.length ) );</span>

<span class="fc" id="L1298">        writeStartTag( SimplifiedDocbookMarkup.TGROUP_TAG, att );</span>

<span class="fc bfc" id="L1300" title="All 2 branches covered.">        for ( int i1 : justification )</span>
        {
            String justif;
<span class="fc bfc" id="L1303" title="All 3 branches covered.">            switch ( i1 )</span>
            {
                case Sink.JUSTIFY_LEFT:
<span class="fc" id="L1306">                    justif = &quot;left&quot;;</span>
<span class="fc" id="L1307">                    break;</span>
                case Sink.JUSTIFY_RIGHT:
<span class="fc" id="L1309">                    justif = &quot;right&quot;;</span>
<span class="fc" id="L1310">                    break;</span>
                case Sink.JUSTIFY_CENTER:
                default:
<span class="fc" id="L1313">                    justif = &quot;center&quot;;</span>
                    break;
            }

<span class="fc" id="L1317">            att = new SimpleAttributeSet();</span>
<span class="fc" id="L1318">            att.addAttribute( &quot;align&quot;, justif );</span>

<span class="fc" id="L1320">            writeSimpleTag( SimplifiedDocbookMarkup.COLSPEC_TAG, att );</span>
        }

<span class="fc" id="L1323">        writeStartTag( SimplifiedDocbookMarkup.TBODY_TAG );</span>
<span class="fc" id="L1324">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TGROUP_TAG
     * @see SimplifiedDocbookMarkup#TBODY_TAG
     */
    public void tableRows_()
    {
<span class="fc" id="L1333">        writeEndTag( SimplifiedDocbookMarkup.TBODY_TAG );</span>
<span class="fc" id="L1334">        writeEndTag( SimplifiedDocbookMarkup.TGROUP_TAG );</span>

        // Remember diverted output and restore original destination ---
<span class="fc" id="L1337">        out.flush();</span>
<span class="pc bpc" id="L1338" title="1 of 2 branches missed.">        if ( tableRowsWriter == null )</span>
        {
<span class="nc" id="L1340">            throw new IllegalArgumentException( &quot;tableRows( int[] justification, boolean grid )&quot;</span>
                                                + &quot; was not called before.&quot; );
        }

<span class="fc" id="L1344">        tableRows = tableRowsWriter.toString();</span>
<span class="fc" id="L1345">        tableRowsWriter = null;</span>
<span class="fc" id="L1346">        out = savedOut;</span>
<span class="fc" id="L1347">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ROW_TAG
     */
    public void tableRow()
    {
<span class="fc" id="L1355">        writeStartTag( SimplifiedDocbookMarkup.ROW_TAG );</span>
<span class="fc" id="L1356">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ROW_TAG
     */
    public void tableRow_()
    {
<span class="fc" id="L1364">        writeEndTag( SimplifiedDocbookMarkup.ROW_TAG );</span>
<span class="fc" id="L1365">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableCell()
    {
<span class="fc" id="L1373">        writeStartTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1374">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableCell_()
    {
<span class="fc" id="L1382">        writeEndTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1383">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableHeaderCell()
    {
<span class="fc" id="L1391">        writeStartTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1392">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableHeaderCell_()
    {
<span class="fc" id="L1400">        writeEndTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1401">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TABLE_TAG
     * @see SimplifiedDocbookMarkup#FRAME_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#ROWSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#COLSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void tableCaption()
    {
<span class="fc" id="L1413">        tableHasCaption = true;</span>

        String frame;
        int sep;
<span class="fc bfc" id="L1417" title="All 2 branches covered.">        if ( tableHasGrid )</span>
        {
<span class="fc" id="L1419">            frame = &quot;all&quot;;</span>
<span class="fc" id="L1420">            sep = 1;</span>
        }
        else
        {
<span class="fc" id="L1424">            frame = &quot;none&quot;;</span>
<span class="fc" id="L1425">            sep = 0;</span>
        }

<span class="fc" id="L1428">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1429">        att.addAttribute( SimplifiedDocbookMarkup.FRAME_ATTRIBUTE, frame );</span>
<span class="fc" id="L1430">        att.addAttribute( SimplifiedDocbookMarkup.ROWSEP_ATTRIBUTE, String.valueOf( sep ) );</span>
<span class="fc" id="L1431">        att.addAttribute( SimplifiedDocbookMarkup.COLSEP_ATTRIBUTE, String.valueOf( sep ) );</span>

<span class="fc" id="L1433">        writeStartTag( TABLE_TAG, att );</span>

<span class="fc" id="L1435">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L1436">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void tableCaption_()
    {
<span class="fc" id="L1444">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L1445">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ANCHOR_TAG
     */
    public void anchor( String name )
    {
<span class="pc bpc" id="L1453" title="1 of 2 branches missed.">        if ( name == null )</span>
        {
<span class="nc" id="L1455">            throw new NullPointerException( &quot;Anchor name cannot be null!&quot; );</span>
        }

<span class="pc bpc" id="L1458" title="1 of 2 branches missed.">        if ( authorDateFlag )</span>
        {
<span class="nc" id="L1460">            return;</span>
        }

<span class="fc" id="L1463">        String id = name;</span>

<span class="pc bpc" id="L1465" title="1 of 2 branches missed.">        if ( !DoxiaUtils.isValidId( id ) )</span>
        {
<span class="nc" id="L1467">            id = DoxiaUtils.encodeId( name, true );</span>

<span class="nc" id="L1469">            String msg = &quot;Modified invalid anchor name: '&quot; + name + &quot;' to '&quot; + id + &quot;'&quot;;</span>
<span class="nc" id="L1470">            logMessage( &quot;modifiedLink&quot;, msg );</span>
        }

<span class="fc" id="L1473">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1474">        att.addAttribute( ID_ATTRIBUTE, id );</span>

<span class="fc" id="L1476">        writeSimpleTag( SimplifiedDocbookMarkup.ANCHOR_TAG, att );</span>
<span class="fc" id="L1477">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ANCHOR_TAG
     */
    public void anchor_()
    {
<span class="fc" id="L1485">        comment( &quot; anchor_end &quot; );</span>
<span class="fc" id="L1486">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ULINK_TAG
     * @see SimplifiedDocbookMarkup#URL_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#LINK_TAG
     * @see SimplifiedDocbookMarkup#LINKEND_ATTRIBUTE
     */
    public void link( String name )
    {
<span class="pc bpc" id="L1497" title="1 of 2 branches missed.">        if ( name == null )</span>
        {
<span class="nc" id="L1499">            throw new NullPointerException( &quot;Link name cannot be null!&quot; );</span>
        }

<span class="fc bfc" id="L1502" title="All 2 branches covered.">        if ( DoxiaUtils.isInternalLink( name ) )</span>
        {
<span class="fc" id="L1504">            String linkend = name.substring( 1 );</span>
<span class="fc" id="L1505">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1506">            att.addAttribute( SimplifiedDocbookMarkup.LINKEND_ATTRIBUTE, escapeHTML( linkend ) );</span>

<span class="fc" id="L1508">            writeStartTag( SimplifiedDocbookMarkup.LINK_TAG, att );</span>
<span class="fc" id="L1509">        }</span>
        else
        {
<span class="fc" id="L1512">            externalLinkFlag = true;</span>
<span class="fc" id="L1513">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1514">            att.addAttribute( SimplifiedDocbookMarkup.URL_ATTRIBUTE, escapeHTML( name, true ) );</span>

<span class="fc" id="L1516">            writeStartTag( SimplifiedDocbookMarkup.ULINK_TAG, att );</span>
        }
<span class="fc" id="L1518">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ULINK_TAG
     * @see SimplifiedDocbookMarkup#LINK_TAG
     */
    public void link_()
    {
<span class="fc bfc" id="L1527" title="All 2 branches covered.">        if ( externalLinkFlag )</span>
        {
<span class="fc" id="L1529">            writeEndTag( SimplifiedDocbookMarkup.ULINK_TAG );</span>
<span class="fc" id="L1530">            externalLinkFlag = false;</span>
        }
        else
        {
<span class="fc" id="L1534">            writeEndTag( SimplifiedDocbookMarkup.LINK_TAG );</span>
        }
<span class="fc" id="L1536">    }</span>

    /** {@inheritDoc} */
    public void inline()
    {
<span class="fc" id="L1541">        inline( null );</span>
<span class="fc" id="L1542">    }</span>

    /** {@inheritDoc} */
    public void inline( SinkEventAttributes attributes )
    {
<span class="fc" id="L1547">        List&lt;String&gt; tags = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L1549" title="All 2 branches covered.">        if ( attributes != null )</span>
        {

<span class="fc bfc" id="L1552" title="All 2 branches covered.">            if ( attributes.containsAttribute( SinkEventAttributes.SEMANTICS, &quot;italic&quot; ) )</span>
            {
<span class="fc" id="L1554">                markup( italicBeginTag );</span>
<span class="fc" id="L1555">                tags.add( 0, italicEndTag );</span>
            }

<span class="fc bfc" id="L1558" title="All 2 branches covered.">            if ( attributes.containsAttribute( SinkEventAttributes.SEMANTICS, &quot;bold&quot; ) )</span>
            {
<span class="fc" id="L1560">                write( boldBeginTag );</span>
<span class="fc" id="L1561">                tags.add( 0, boldEndTag );</span>
            }

<span class="fc bfc" id="L1564" title="All 2 branches covered.">            if ( attributes.containsAttribute( SinkEventAttributes.SEMANTICS, &quot;code&quot; ) )</span>
            {
<span class="pc bpc" id="L1566" title="1 of 2 branches missed.">                if ( !authorDateFlag )</span>
                {
<span class="fc" id="L1568">                    write( monospacedBeginTag );</span>
<span class="fc" id="L1569">                    tags.add( 0, monospacedEndTag );</span>
                }
            }

        }

<span class="fc" id="L1575">        inlineStack.push( tags );</span>
<span class="fc" id="L1576">    }</span>

    /** {@inheritDoc} */
    public void inline_()
    {
<span class="fc bfc" id="L1581" title="All 2 branches covered.">        for ( String tag: inlineStack.pop() )</span>
        {
<span class="fc" id="L1583">            markup( tag );</span>
<span class="fc" id="L1584">        }</span>
<span class="fc" id="L1585">    }</span>

    /** {@inheritDoc} */
    public void italic()
    {
<span class="fc" id="L1590">        inline( SinkEventAttributeSet.Semantics.ITALIC );</span>
<span class="fc" id="L1591">    }</span>

    /** {@inheritDoc} */
    public void italic_()
    {
<span class="fc" id="L1596">        inline_();</span>
<span class="fc" id="L1597">    }</span>

    /** {@inheritDoc} */
    public void bold()
    {
<span class="fc" id="L1602">        inline( SinkEventAttributeSet.Semantics.BOLD );</span>
<span class="fc" id="L1603">    }</span>

    /** {@inheritDoc} */
    public void bold_()
    {
<span class="fc" id="L1608">        inline_();</span>
<span class="fc" id="L1609">    }</span>

    /** {@inheritDoc} */
    public void monospaced()
    {
<span class="fc" id="L1614">        inline( SinkEventAttributeSet.Semantics.CODE );</span>
<span class="fc" id="L1615">    }</span>

    /** {@inheritDoc} */
    public void monospaced_()
    {
<span class="fc" id="L1620">        inline_();</span>
<span class="fc" id="L1621">    }</span>

    /** {@inheritDoc} */
    public void lineBreak()
    {
<span class="fc" id="L1626">        markup( lineBreakElement );</span>
<span class="fc" id="L1627">    }</span>

    /** {@inheritDoc} */
    public void nonBreakingSpace()
    {
<span class="fc" id="L1632">        markup( &quot;&amp;#x00A0;&quot; );</span>
        //markup( &quot;&amp;nbsp;&quot; );
<span class="fc" id="L1634">    }</span>

    /** {@inheritDoc} */
    public void text( String text )
    {
<span class="fc bfc" id="L1639" title="All 2 branches covered.">        if ( verbatimFlag )</span>
        {
<span class="fc" id="L1641">            verbatimContent( text );</span>
        }
        else
        {
<span class="fc" id="L1645">            content( text );</span>
        }
<span class="fc" id="L1647">    }</span>

    /** {@inheritDoc} */
    public void comment( String comment )
    {
<span class="pc bpc" id="L1652" title="1 of 2 branches missed.">        if ( comment != null )</span>
        {
<span class="fc" id="L1654">            String originalComment = comment;</span>

            // http://www.w3.org/TR/2000/REC-xml-20001006#sec-comments
<span class="fc bfc" id="L1657" title="All 2 branches covered.">            while ( comment.contains( &quot;--&quot; ) )</span>
            {
<span class="fc" id="L1659">                comment = comment.replace( &quot;--&quot;, &quot;- -&quot; );</span>
            }

<span class="fc bfc" id="L1662" title="All 2 branches covered.">            if ( comment.endsWith( &quot;-&quot; ) )</span>
            {
<span class="fc" id="L1664">                comment += &quot; &quot;;</span>
            }

<span class="fc bfc" id="L1667" title="All 2 branches covered.">            if ( !originalComment.equals( comment ) )</span>
            {
<span class="fc" id="L1669">                String msg = &quot;Modified invalid comment: '&quot; + originalComment + &quot;' to '&quot; + comment + &quot;'&quot;;</span>
<span class="fc" id="L1670">                logMessage( &quot;modifiedComment&quot;, msg );</span>
            }

<span class="fc" id="L1673">            StringBuilder buffer = new StringBuilder( comment.length() + 7 );</span>

<span class="fc" id="L1675">            buffer.append( LESS_THAN ).append( BANG ).append( MINUS ).append( MINUS );</span>
<span class="fc" id="L1676">            buffer.append( comment );</span>
<span class="fc" id="L1677">            buffer.append( MINUS ).append( MINUS ).append( GREATER_THAN );</span>

<span class="fc" id="L1679">            markup( buffer.toString() );</span>
        }
<span class="fc" id="L1681">    }</span>

    /**
     * {@inheritDoc}
     *
     * Unknown events just log a warning message but are ignored otherwise.
     * @see org.apache.maven.doxia.sink.Sink#unknown(String,Object[],SinkEventAttributes)
     */
    public void unknown( String name, Object[] requiredParams, SinkEventAttributes attributes )
    {
<span class="fc" id="L1691">        String msg = &quot;Unknown Sink event: '&quot; + name + &quot;', ignoring!&quot;;</span>
<span class="fc" id="L1692">        logMessage( &quot;unknownEvent&quot;, msg );</span>
<span class="fc" id="L1693">    }</span>

    // -----------------------------------------------------------------------

    /**
     * Write text to output, preserving white space.
     *
     * @param text The text to write.
     */
    protected void markup( String text )
    {
<span class="pc bpc" id="L1704" title="1 of 2 branches missed.">        if ( !skip )</span>
        {
<span class="fc" id="L1706">            out.write( text );</span>
        }
<span class="fc" id="L1708">    }</span>

    /**
     * Write SGML escaped text to output, not preserving white space.
     *
     * @param text The text to write.
     */
    protected void content( String text )
    {
<span class="pc bpc" id="L1717" title="1 of 2 branches missed.">        if ( !skip )</span>
        {
<span class="fc" id="L1719">            out.write( escapeHTML( text, true ) );</span>
        }
<span class="fc" id="L1721">    }</span>

    /**
     * Write SGML escaped text to output, preserving white space.
     *
     * @param text The text to write.
     */
    protected void verbatimContent( String text )
    {
<span class="pc bpc" id="L1730" title="1 of 2 branches missed.">        if ( !skip )</span>
        {
<span class="fc" id="L1732">            out.write( escapeHTML( text, true ) );</span>
        }
<span class="fc" id="L1734">    }</span>

    // -----------------------------------------------------------------------

    /** {@inheritDoc} */
    public void flush()
    {
<span class="fc" id="L1741">        out.flush();</span>
<span class="fc" id="L1742">    }</span>

    /** {@inheritDoc} */
    public void close()
    {
<span class="fc" id="L1747">        out.close();</span>

<span class="pc bpc" id="L1749" title="1 of 4 branches missed.">        if ( getLog().isWarnEnabled() &amp;&amp; this.warnMessages != null )</span>
        {
<span class="fc bfc" id="L1751" title="All 2 branches covered.">            for ( Map.Entry&lt;String, Set&lt;String&gt;&gt; entry : this.warnMessages.entrySet() )</span>
            {
<span class="fc bfc" id="L1753" title="All 2 branches covered.">                for ( String msg : entry.getValue() )</span>
                {
<span class="fc" id="L1755">                    getLog().warn( msg );</span>
<span class="fc" id="L1756">                }</span>
<span class="fc" id="L1757">            }</span>

<span class="fc" id="L1759">            this.warnMessages = null;</span>
        }
<span class="fc" id="L1761">    }</span>

    /** {@inheritDoc} */
    protected void write( String text )
    {
<span class="fc" id="L1766">        markup( unifyEOLs( text ) );</span>
<span class="fc" id="L1767">    }</span>

    /**
     * &lt;p&gt;Setter for the field &lt;code&gt;skip&lt;/code&gt;.&lt;/p&gt;
     *
     * @param skip the skip to set.
     * @since 1.1
     */
    public void setSkip( boolean skip )
    {
<span class="nc" id="L1777">        this.skip = skip;</span>
<span class="nc" id="L1778">    }</span>

    /**
     * If debug mode is enabled, log the &lt;code&gt;msg&lt;/code&gt; as is, otherwise add unique msg in &lt;code&gt;warnMessages&lt;/code&gt;.
     *
     * @param key not null
     * @param msg not null
     * @see #close()
     * @since 1.1.1
     */
    private void logMessage( String key, String msg )
    {
<span class="fc" id="L1790">        msg = &quot;[Docbook Sink] &quot; + msg;</span>
<span class="pc bpc" id="L1791" title="1 of 2 branches missed.">        if ( getLog().isDebugEnabled() )</span>
        {
<span class="nc" id="L1793">            getLog().debug( msg );</span>

<span class="nc" id="L1795">            return;</span>
        }

<span class="fc bfc" id="L1798" title="All 2 branches covered.">        if ( warnMessages == null )</span>
        {
<span class="fc" id="L1800">            warnMessages = new HashMap&lt;&gt;();</span>
        }

<span class="fc" id="L1803">        Set&lt;String&gt; set = warnMessages.get( key );</span>
<span class="fc bfc" id="L1804" title="All 2 branches covered.">        if ( set == null )</span>
        {
<span class="fc" id="L1806">            set = new TreeSet&lt;&gt;();</span>
        }
<span class="fc" id="L1808">        set.add( msg );</span>
<span class="fc" id="L1809">        warnMessages.put( key, set );</span>
<span class="fc" id="L1810">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>