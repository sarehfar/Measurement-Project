<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DocBookSink.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Doxia :: Simplified DocBook Module</a> &gt; <a href="index.source.html" class="el_package">org.apache.maven.doxia.module.docbook</a> &gt; <span class="el_source">DocBookSink.java</span></div><h1>DocBookSink.java</h1><pre class="source lang-java linenums">package org.apache.maven.doxia.module.docbook;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import java.io.PrintWriter;
import java.io.StringWriter;
import java.io.Writer;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.StringTokenizer;
import java.util.TreeSet;

import javax.swing.text.MutableAttributeSet;
import javax.swing.text.SimpleAttributeSet;

import org.apache.maven.doxia.sink.SinkEventAttributes;
import org.apache.maven.doxia.sink.impl.AbstractXmlSink;
import org.apache.maven.doxia.sink.Sink;
import org.apache.maven.doxia.util.DoxiaUtils;
import org.apache.maven.doxia.util.HtmlTools;

import org.codehaus.plexus.util.FileUtils;

/**
 * &lt;a href=&quot;http://www.oasis-open.org/docbook&quot;&gt;Docbook&lt;/a&gt; Sink implementation.
 * &lt;br/&gt;
 * It uses the Docbook v4.4 DTD &lt;a href=&quot;http://www.oasis-open.org/docbook/sgml/4.4/docbookx.dtd&quot;&gt;
 * http://www.oasis-open.org/docbook/sgml/4.4/docbookx.dtd&lt;/a&gt;.
 *
 * @version $Id$
 * @since 1.0
 */
public class DocBookSink
    extends AbstractXmlSink
    implements DocbookMarkup, SimplifiedDocbookMarkup
{
    /** DocBook V4.4 SGML public id: &quot;-//OASIS//DTD DocBook V4.4//EN&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_SGML_PUBLIC_ID} instead of. */
    public static final String DEFAULT_SGML_PUBLIC_ID = DocbookMarkup.DEFAULT_SGML_PUBLIC_ID;

    /** DocBook XML V4.4 XML public id: &quot;-//OASIS//DTD DocBook XML V4.4//EN&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_XML_PUBLIC_ID} instead of. */
    public static final String DEFAULT_XML_PUBLIC_ID = DocbookMarkup.DEFAULT_XML_PUBLIC_ID;

    /** DocBook XML V4.4 XML system id: &quot;http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_XML_SYSTEM_ID} instead of. */
    public static final String DEFAULT_XML_SYSTEM_ID = DocbookMarkup.DEFAULT_XML_SYSTEM_ID;

    /** DocBook XML V4.4 SGML system id: &quot;http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd&quot;
     * @deprecated since 1.1, use {@link DocbookMarkup#DEFAULT_SGML_SYSTEM_ID} instead of. */
    public static final String DEFAULT_SGML_SYSTEM_ID = DocbookMarkup.DEFAULT_SGML_SYSTEM_ID;

    /** The output writer. */
    private PrintWriter out;

    /** xmlMode. */
<span class="fc" id="L76">    private boolean xmlMode = false;</span>

    /** styleSheet. */
<span class="fc" id="L79">    private String styleSheet = null;</span>

    /** language. */
<span class="fc" id="L82">    private String lang = null;</span>

    /** publicId. */
<span class="fc" id="L85">    private String publicId = null;</span>

    /** systemId. */
<span class="fc" id="L88">    private String systemId = null;</span>

    /** italicBegin. */
    private String italicBeginTag;

    /** italicEnd. */
    private String italicEndTag;

    /** boldBegin. */
    private String boldBeginTag;

    /** boldEnd. */
    private String boldEndTag;

    /** monospacedBegin. */
    private String monospacedBeginTag;

    /** monospacedEnd. */
    private String monospacedEndTag;

    /** horizontalRule. */
    private String horizontalRuleElement;

    /** pageBreak. */
    private String pageBreakElement;

    /** lineBreak. */
    private String lineBreakElement;

    /** An image source file. */
    private String graphicsFileName;

    /** hasTitle. */
    private boolean hasTitle;

    /** authorDate. */
    private boolean authorDateFlag;

    /** verbatim. */
    private boolean verbatimFlag;

    /** externalLink. */
    private boolean externalLinkFlag;

    /** tableHasCaption. */
    private boolean tableHasCaption;

    /** Used for table rows. */
    private PrintWriter savedOut;

    /** tableRows. */
    private String tableRows;

    /** tableRows writer. */
    private StringWriter tableRowsWriter;

    /** tableHasGrid. */
    private boolean tableHasGrid;

    private boolean skip;

    private boolean paragraph;

    private String encoding;

    /** Map of warn messages with a String as key to describe the error type and a Set as value.
     * Using to reduce warn messages. */
    private Map&lt;String, Set&lt;String&gt;&gt; warnMessages;

    /**
     * Constructor, initialize the Writer.
     *
     * @param writer not null writer to write the result. &lt;b&gt;Should&lt;/b&gt; be an UTF-8 Writer.
     * You could use &lt;code&gt;newXmlWriter&lt;/code&gt; methods from {@link org.codehaus.plexus.util.WriterFactory}.
     */
    protected DocBookSink( Writer writer )
    {
<span class="fc" id="L165">        this( writer, null );</span>
<span class="fc" id="L166">    }</span>

    /**
     * Constructor, initialize the Writer and tells which encoding is used.
     *
     * @param writer not null writer to write the result.
     * @param encoding the encoding used, that should be written to the generated HTML content
     * if not &lt;code&gt;null&lt;/code&gt;.
     */
    protected DocBookSink( Writer writer, String encoding )
<span class="fc" id="L176">    {</span>
<span class="fc" id="L177">        this.out = new PrintWriter( writer );</span>
<span class="fc" id="L178">        this.encoding = encoding;</span>

<span class="fc" id="L180">        setItalicElement( &quot;&lt;emphasis&gt;&quot; );</span>
<span class="fc" id="L181">        setBoldElement( &quot;&lt;emphasis role=\&quot;bold\&quot;&gt;&quot; );</span>
<span class="fc" id="L182">        setMonospacedElement( &quot;&lt;literal&gt;&quot; );</span>
<span class="fc" id="L183">        setHorizontalRuleElement( &quot;&lt;!-- HR --&gt;&quot; );</span>
<span class="fc" id="L184">        setPageBreakElement( &quot;&lt;!-- PB --&gt;&quot; );</span>
<span class="fc" id="L185">        setLineBreakElement( &quot;&lt;!-- LB --&gt;&quot; );</span>
<span class="fc" id="L186">    }</span>

    /**
     * Constructor, initialize the Writer and tells which encoding and languageId are used.
     *
     * @param writer not null writer to write the result.
     * @param encoding the encoding used, that should be written to the generated HTML content
     * if not &lt;code&gt;null&lt;/code&gt;.
     * @param languageId language identifier for the root element as defined by
     * &lt;a href=&quot;ftp://ftp.isi.edu/in-notes/bcp/bcp47.txt&quot;&gt;IETF BCP 47&lt;/a&gt;, Tags for the Identification of Languages;
     * in addition, the empty string may be specified.
     * @since 1.1
     */
    protected DocBookSink( Writer writer, String encoding, String languageId )
    {
<span class="nc" id="L201">        this( writer, encoding );</span>

<span class="nc" id="L203">        this.lang = languageId;</span>
<span class="nc" id="L204">    }</span>

    /**
     * &lt;p&gt;escapeSGML&lt;/p&gt;
     *
     * @param text The text to escape.
     * @param xmlMode xmlMode.
     * @return The escaped text.
     * @deprecated Use HtmlTools#escapeHTML(String,boolean).
     */
    public static final String escapeSGML( String text, boolean xmlMode )
    {
<span class="nc" id="L216">        return HtmlTools.escapeHTML( text, xmlMode );</span>
    }

    /**
     * Sets the xml mode.
     *
     * @param mode the mode to set.
     * @deprecated xml mode is not used.
     */
    public void setXMLMode( boolean mode )
    {
<span class="nc" id="L227">        this.xmlMode = mode;</span>
<span class="nc" id="L228">    }</span>

    /**
     * Returns the current xmlMode.
     *
     * @return the current xmlMode.
     * @deprecated xml mode is not used.
     */
    public boolean isXMLMode()
    {
<span class="nc" id="L238">        return xmlMode;</span>
    }

    /**
     * Sets the encoding. The encoding specified here must be consistent with then encoding
     * used in the Writer used by this DocBookSink instance.
     *
     * @param enc the encoding to set.
     */
    public void setEncoding( String enc )
    {
<span class="nc" id="L249">        encoding = enc;</span>
<span class="nc" id="L250">    }</span>

    /**
     * Returns the encoding.
     *
     * @return the encoding set (can be &lt;code&gt;null&lt;/code&gt;).
     */
    public String getEncoding()
    {
<span class="nc" id="L259">        return encoding;</span>
    }

    /**
     * Sets the styleSheet.
     *
     * @param sheet the styleSheet to set.
     */
    public void setStyleSheet( String sheet )
    {
<span class="nc" id="L269">        this.styleSheet = sheet;</span>
<span class="nc" id="L270">    }</span>

    /**
     * Returns the current styleSheet.
     *
     * @return the current styleSheet.
     */
    public String getStyleSheet()
    {
<span class="nc" id="L279">        return styleSheet;</span>
    }

    /**
     * Sets the publicId.
     *
     * @param id the publicId to set.
     */
    public void setPublicId( String id )
    {
<span class="nc" id="L289">        this.publicId = id;</span>
<span class="nc" id="L290">    }</span>

    /**
     * Returns the current publicId.
     *
     * @return the current publicId.
     */
    public String getPublicId()
    {
<span class="nc" id="L299">        return publicId;</span>
    }

    /**
     * Sets the systemId.
     *
     * @param id the systemId to set.
     */
    public void setSystemId( String id )
    {
<span class="nc" id="L309">        this.systemId = id;</span>
<span class="nc" id="L310">    }</span>

    /**
     * Returns the current systemId.
     *
     * @return the current systemId.
     */
    public String getSystemId()
    {
<span class="nc" id="L319">        return systemId;</span>
    }

    /**
     * Sets the language.
     *
     * @param language the language to set.
     */
    public void setLanguage( String language )
    {
<span class="nc" id="L329">        this.lang = language;</span>
<span class="nc" id="L330">    }</span>

    /**
     * Returns the current language.
     *
     * @return the current language.
     */
    public String getLanguage()
    {
<span class="nc" id="L339">        return lang;</span>
    }

    /**
     * Sets the current italicBeginTag and constructs the corresponding end tag from it.
     *
     * @param tag the tag to set. If tag is null, the empty string is used.
     */
    public void setItalicElement( String tag )
    {
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">        if ( tag == null )</span>
        {
<span class="nc" id="L351">            tag = &quot;&quot;;</span>
        }
<span class="fc" id="L353">        this.italicBeginTag = tag;</span>
<span class="fc" id="L354">        italicEndTag = makeEndTag( italicBeginTag );</span>
<span class="fc" id="L355">    }</span>

    /**
     * Constructs the corresponding end tag from the given begin tag.
     *
     * @param beginTag the begin tag to set. If null, the empty string is returned.
     * @return the corresponding end tag.
     */
    private String makeEndTag( String beginTag )
    {
<span class="fc" id="L365">        int length = beginTag.length();</span>
<span class="pc bpc" id="L366" title="1 of 2 branches missed.">        if ( length == 0 )</span>
        {
<span class="nc" id="L368">            return &quot;&quot;;</span>
        }

<span class="pc bpc" id="L371" title="2 of 4 branches missed.">        if ( beginTag.charAt( 0 ) != '&lt;' || beginTag.charAt( length - 1 ) != '&gt;' )</span>
        {
<span class="nc" id="L373">            throw new IllegalArgumentException( &quot;'&quot; + beginTag + &quot;', not a tag&quot; );</span>
        }

<span class="fc" id="L376">        StringTokenizer tokens = new StringTokenizer( beginTag, &quot;&lt;&gt; \t\n\r\f&quot; );</span>
<span class="pc bpc" id="L377" title="1 of 2 branches missed.">        if ( !tokens.hasMoreTokens() )</span>
        {
<span class="nc" id="L379">            throw new IllegalArgumentException( &quot;'&quot; + beginTag + &quot;', invalid tag&quot; );</span>
        }

<span class="fc" id="L382">        return &quot;&lt;/&quot; + tokens.nextToken() + &quot;&gt;&quot;;</span>
    }

    /**
     * Returns the current italicBeginTag.
     *
     * @return the current italicBeginTag. Defaults to &quot;&lt;emphasis&gt;&quot;.
     */
    public String getItalicElement()
    {
<span class="nc" id="L392">        return italicBeginTag;</span>
    }

    /**
     * Sets the current boldBeginTag and constructs the corresponding end tag from it.
     *
     * @param tag the tag to set. If tag is null, the empty string is used.
     */
    public void setBoldElement( String tag )
    {
<span class="pc bpc" id="L402" title="1 of 2 branches missed.">        if ( tag == null )</span>
        {
<span class="nc" id="L404">            tag = &quot;&quot;;</span>
        }
<span class="fc" id="L406">        this.boldBeginTag = tag;</span>
<span class="fc" id="L407">        boldEndTag = makeEndTag( boldBeginTag );</span>
<span class="fc" id="L408">    }</span>

    /**
     * Returns the current boldBeginTag.
     *
     * @return the current boldBeginTag. Defaults to &quot;&lt;emphasis role=\&quot;bold\&quot;&gt;&quot;.
     */
    public String getBoldElement()
    {
<span class="nc" id="L417">        return boldBeginTag;</span>
    }

    /**
     * Sets the current monospacedBeginTag and constructs the corresponding end tag from it.
     *
     * @param tag the tag to set. If tag is null, the empty string is used.
     */
    public void setMonospacedElement( String tag )
    {
<span class="pc bpc" id="L427" title="1 of 2 branches missed.">        if ( tag == null )</span>
        {
<span class="nc" id="L429">            tag = &quot;&quot;;</span>
        }
<span class="fc" id="L431">        this.monospacedBeginTag = tag;</span>
<span class="fc" id="L432">        monospacedEndTag = makeEndTag( monospacedBeginTag );</span>
<span class="fc" id="L433">    }</span>

    /**
     * Returns the current monospacedBeginTag.
     *
     * @return the current monospacedBeginTag. Defaults to &quot;&lt;literal&gt;&gt;&quot;.
     */
    public String getMonospacedElement()
    {
<span class="nc" id="L442">        return monospacedBeginTag;</span>
    }

    /**
     * Sets the current horizontalRuleElement.
     *
     * @param element the element to set.
     */
    public void setHorizontalRuleElement( String element )
    {
<span class="fc" id="L452">        this.horizontalRuleElement = element;</span>
<span class="fc" id="L453">    }</span>

    /**
     * Returns the current horizontalRuleElement.
     *
     * @return the current horizontalRuleElement. Defaults to &quot;&lt;!-- HR --&gt;&quot;.
     */
    public String getHorizontalRuleElement()
    {
<span class="nc" id="L462">        return horizontalRuleElement;</span>
    }

    /**
     * Sets the current pageBreakElement.
     *
     * @param element the element to set.
     */
    public void setPageBreakElement( String element )
    {
<span class="fc" id="L472">        this.pageBreakElement = element;</span>
<span class="fc" id="L473">    }</span>

    /**
     * Returns the current pageBreakElement.
     *
     * @return the current pageBreakElement. Defaults to &quot;&lt;!-- PB --&gt;&quot;.
     */
    public String getPageBreakElement()
    {
<span class="nc" id="L482">        return pageBreakElement;</span>
    }

    /**
     * Sets the current lineBreakElement.
     *
     * @param element the element to set.
     */
    public void setLineBreakElement( String element )
    {
<span class="fc" id="L492">        this.lineBreakElement = element;</span>
<span class="fc" id="L493">    }</span>

    /**
     * Returns the current lineBreakElement.
     *
     * @return the current lineBreakElement. Defaults to &quot;&lt;!-- LB --&gt;&quot;.
     */
    public String getLineBreakElement()
    {
<span class="nc" id="L502">        return lineBreakElement;</span>
    }

    /**
     * Reset all variables.
     *
     * @deprecated since 1.1.2, use {@link #init()} instead of.
     */
    protected void resetState()
    {
<span class="nc" id="L512">       init();</span>
<span class="nc" id="L513">    }</span>

    /** {@inheritDoc} */
    protected void init()
    {
<span class="fc" id="L518">        hasTitle = false;</span>
<span class="fc" id="L519">        authorDateFlag = false;</span>
<span class="fc" id="L520">        verbatimFlag = false;</span>
<span class="fc" id="L521">        externalLinkFlag = false;</span>
<span class="fc" id="L522">        graphicsFileName = null;</span>
<span class="fc" id="L523">        tableHasCaption = false;</span>
<span class="fc" id="L524">        savedOut = null;</span>
<span class="fc" id="L525">        tableRows = null;</span>
<span class="fc" id="L526">        tableHasGrid = false;</span>
<span class="fc" id="L527">    }</span>

    // ----------------------------------------------------------------------
    //
    // ----------------------------------------------------------------------

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_PUBLIC_ID
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_SYSTEM_ID
     * @see SimplifiedDocbookMarkup#ARTICLE_TAG
     */
    public void head()
    {
<span class="fc" id="L541">        init();</span>

<span class="fc" id="L543">        MutableAttributeSet att = writeXmlHeader( &quot;article&quot; );</span>

<span class="fc" id="L545">        writeStartTag( SimplifiedDocbookMarkup.ARTICLE_TAG, att );</span>
<span class="fc" id="L546">    }</span>

    /**
     * writeXmlHeader.
     *
     * @param root not null.
     * @return an attribute set.
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_PUBLIC_ID
     * @see SimplifiedDocbookMarkup#DEFAULT_XML_SYSTEM_ID
     * @see SimplifiedDocbookMarkup#ARTICLE_TAG
     * @since 1.1
     */
    protected MutableAttributeSet writeXmlHeader( String root )
    {
<span class="fc" id="L560">        markup( &quot;&lt;?xml version=\&quot;1.0\&quot;&quot; );</span>
<span class="fc bfc" id="L561" title="All 2 branches covered.">        if ( encoding != null )</span>
        {
<span class="fc" id="L563">            markup( &quot; encoding=\&quot;&quot; + encoding + &quot;\&quot;&quot; );</span>
        }
<span class="fc" id="L565">        markup( &quot;?&gt;&quot; );</span>

<span class="pc bpc" id="L567" title="1 of 2 branches missed.">        if ( styleSheet != null )</span>
        {
<span class="nc" id="L569">            markup( &quot;&lt;?xml-stylesheet type=\&quot;text/css\&quot; href=\&quot;&quot; + styleSheet + &quot;\&quot; ?&gt;&quot; );</span>
        }

        String pubId;
<span class="fc" id="L573">        markup( &quot;&lt;!DOCTYPE &quot; + root + &quot; PUBLIC&quot; );</span>

<span class="pc bpc" id="L575" title="1 of 2 branches missed.">        if ( publicId == null )</span>
        {
<span class="fc" id="L577">            pubId = SimplifiedDocbookMarkup.DEFAULT_XML_PUBLIC_ID;</span>
        }
        else
        {
<span class="nc" id="L581">            pubId = publicId;</span>
        }
<span class="fc" id="L583">        markup( &quot; \&quot;&quot; + pubId + &quot;\&quot;&quot; );</span>
<span class="fc" id="L584">        String sysId = systemId;</span>
<span class="pc bpc" id="L585" title="1 of 2 branches missed.">        if ( sysId == null )</span>
        {
<span class="fc" id="L587">                sysId = SimplifiedDocbookMarkup.DEFAULT_XML_SYSTEM_ID;</span>
        }
<span class="fc" id="L589">        markup( &quot; \&quot;&quot; + sysId + &quot;\&quot;&gt;&quot; );</span>

<span class="fc" id="L591">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="pc bpc" id="L592" title="1 of 2 branches missed.">        if ( lang != null )</span>
        {
<span class="nc" id="L594">            att.addAttribute( LANG_ATTRIBUTE, lang );</span>
        }
<span class="fc" id="L596">        return att;</span>
    }

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ARTICLEINFO_TAG
     */
    public void head_()
    {
<span class="fc bfc" id="L605" title="All 2 branches covered.">        if ( hasTitle )</span>
        {
<span class="fc" id="L607">            writeEndTag( SimplifiedDocbookMarkup.ARTICLEINFO_TAG );</span>
<span class="fc" id="L608">            hasTitle = false;</span>
        }
<span class="fc" id="L610">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ARTICLEINFO_TAG
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void title()
    {
<span class="fc" id="L619">        writeStartTag( SimplifiedDocbookMarkup.ARTICLEINFO_TAG );</span>
<span class="fc" id="L620">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L621">        hasTitle = true;</span>
<span class="fc" id="L622">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void title_()
    {
<span class="fc" id="L630">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L631">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#CORPAUTHOR_TAG
     */
    public void author()
    {
<span class="fc" id="L639">        authorDateFlag = true;</span>
<span class="fc" id="L640">        writeStartTag( SimplifiedDocbookMarkup.CORPAUTHOR_TAG );</span>
<span class="fc" id="L641">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#CORPAUTHOR_TAG
     */
    public void author_()
    {
<span class="fc" id="L649">        writeEndTag( SimplifiedDocbookMarkup.CORPAUTHOR_TAG );</span>
<span class="fc" id="L650">        authorDateFlag = false;</span>
<span class="fc" id="L651">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#DATE_TAG
     */
    public void date()
    {
<span class="fc" id="L659">        authorDateFlag = true;</span>
<span class="fc" id="L660">        writeStartTag( SimplifiedDocbookMarkup.DATE_TAG );</span>
<span class="fc" id="L661">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#DATE_TAG
     */
    public void date_()
    {
<span class="fc" id="L669">        writeEndTag( SimplifiedDocbookMarkup.DATE_TAG );</span>
<span class="fc" id="L670">        authorDateFlag = false;</span>
<span class="fc" id="L671">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ARTICLE_TAG
     */
    public void body_()
    {
<span class="fc" id="L679">        writeEndTag( SimplifiedDocbookMarkup.ARTICLE_TAG );</span>
<span class="fc" id="L680">        out.flush();</span>
<span class="fc" id="L681">        init();</span>
<span class="fc" id="L682">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section1()
    {
<span class="fc" id="L690">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L691">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section1_()
    {
<span class="fc" id="L699">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L700">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section2()
    {
<span class="fc" id="L708">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L709">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section2_()
    {
<span class="fc" id="L717">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L718">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section3()
    {
<span class="fc" id="L726">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L727">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section3_()
    {
<span class="fc" id="L735">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L736">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section4()
    {
<span class="fc" id="L744">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L745">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section4_()
    {
<span class="fc" id="L753">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L754">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section5()
    {
<span class="fc" id="L762">        writeStartTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L763">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#SECTION_TAG
     */
    public void section5_()
    {
<span class="fc" id="L771">        writeEndTag( SimplifiedDocbookMarkup.SECTION_TAG );</span>
<span class="fc" id="L772">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle()
    {
<span class="fc" id="L780">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L781">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle_()
    {
<span class="fc" id="L789">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L790">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle1()
    {
<span class="fc" id="L798">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L799">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle1_()
    {
<span class="fc" id="L807">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L808">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle2()
    {
<span class="fc" id="L816">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L817">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle2_()
    {
<span class="fc" id="L825">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L826">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle3()
    {
<span class="fc" id="L834">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L835">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle3_()
    {
<span class="fc" id="L843">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L844">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle4()
    {
<span class="fc" id="L852">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L853">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle4_()
    {
<span class="fc" id="L861">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L862">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle5()
    {
<span class="fc" id="L870">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L871">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void sectionTitle5_()
    {
<span class="fc" id="L879">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L880">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ITEMIZEDLIST_TAG
     */
    public void list()
    {
<span class="fc" id="L888">        paragraph_();</span>
<span class="fc" id="L889">        writeStartTag( SimplifiedDocbookMarkup.ITEMIZEDLIST_TAG );</span>
<span class="fc" id="L890">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ITEMIZEDLIST_TAG
     */
    public void list_()
    {
<span class="fc" id="L898">        writeEndTag( SimplifiedDocbookMarkup.ITEMIZEDLIST_TAG );</span>
<span class="fc" id="L899">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void listItem()
    {
<span class="fc" id="L907">        writeStartTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L908">        paragraph();</span>
<span class="fc" id="L909">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void listItem_()
    {
<span class="fc" id="L917">        paragraph_();</span>
<span class="fc" id="L918">        writeEndTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L919">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ORDEREDLIST_TAG
     * @see SimplifiedDocbookMarkup#NUMERATION_ATTRIBUTE
     */
    public void numberedList( int numbering )
    {
<span class="fc" id="L928">        String numeration = DocbookUtils.docbookListNumbering( numbering );</span>

<span class="fc" id="L930">        paragraph_();</span>

<span class="fc" id="L932">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L933">        att.addAttribute( SimplifiedDocbookMarkup.NUMERATION_ATTRIBUTE, numeration );</span>

<span class="fc" id="L935">        writeStartTag( SimplifiedDocbookMarkup.ORDEREDLIST_TAG, att );</span>
<span class="fc" id="L936">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ORDEREDLIST_TAG
     */
    public void numberedList_()
    {
<span class="fc" id="L944">        writeEndTag( SimplifiedDocbookMarkup.ORDEREDLIST_TAG );</span>
<span class="fc" id="L945">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void numberedListItem()
    {
<span class="fc" id="L953">        writeStartTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L954">        paragraph();</span>
<span class="fc" id="L955">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void numberedListItem_()
    {
<span class="fc" id="L963">        paragraph_();</span>
<span class="fc" id="L964">        writeEndTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L965">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARIABLELIST_TAG
     */
    public void definitionList()
    {
<span class="fc" id="L973">        paragraph_();</span>
<span class="fc" id="L974">        writeStartTag( SimplifiedDocbookMarkup.VARIABLELIST_TAG );</span>
<span class="fc" id="L975">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARIABLELIST_TAG
     */
    public void definitionList_()
    {
<span class="fc" id="L983">        writeEndTag( SimplifiedDocbookMarkup.VARIABLELIST_TAG );</span>
<span class="fc" id="L984">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARLISTENTRY_TAG
     */
    public void definitionListItem()
    {
<span class="fc" id="L992">        writeStartTag( SimplifiedDocbookMarkup.VARLISTENTRY_TAG );</span>
<span class="fc" id="L993">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#VARLISTENTRY_TAG
     */
    public void definitionListItem_()
    {
<span class="fc" id="L1001">        writeEndTag( SimplifiedDocbookMarkup.VARLISTENTRY_TAG );</span>
<span class="fc" id="L1002">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TERM_TAG
     */
    public void definedTerm()
    {
<span class="fc" id="L1010">        writeStartTag( SimplifiedDocbookMarkup.TERM_TAG );</span>
<span class="fc" id="L1011">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TERM_TAG
     */
    public void definedTerm_()
    {
<span class="fc" id="L1019">        writeEndTag( SimplifiedDocbookMarkup.TERM_TAG );</span>
<span class="fc" id="L1020">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void definition()
    {
<span class="fc" id="L1028">        writeStartTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L1029">        paragraph();</span>
<span class="fc" id="L1030">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#LISTITEM_TAG
     */
    public void definition_()
    {
<span class="fc" id="L1038">        paragraph_();</span>
<span class="fc" id="L1039">        writeEndTag( SimplifiedDocbookMarkup.LISTITEM_TAG );</span>
<span class="fc" id="L1040">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PARA_TAG
     */
    public void paragraph()
    {
<span class="fc bfc" id="L1048" title="All 2 branches covered.">        if ( !paragraph )</span>
        {
<span class="fc" id="L1050">            writeStartTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1051">            paragraph = true;</span>
        }
<span class="fc" id="L1053">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PARA_TAG
     */
    public void paragraph_()
    {
<span class="fc bfc" id="L1061" title="All 2 branches covered.">        if ( paragraph )</span>
        {
<span class="fc" id="L1063">            writeEndTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1064">            paragraph = false;</span>
        }
<span class="fc" id="L1066">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PROGRAMLISTING_TAG
     */
    public void verbatim( boolean boxed )
    {
<span class="fc" id="L1074">        verbatimFlag = true;</span>
<span class="fc" id="L1075">        paragraph_();</span>
<span class="fc" id="L1076">        writeStartTag( SimplifiedDocbookMarkup.PROGRAMLISTING_TAG );</span>
<span class="fc" id="L1077">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#PROGRAMLISTING_TAG
     */
    public void verbatim_()
    {
<span class="fc" id="L1085">        writeEndTag( SimplifiedDocbookMarkup.PROGRAMLISTING_TAG );</span>
<span class="fc" id="L1086">        verbatimFlag = false;</span>
<span class="fc" id="L1087">    }</span>

    /** {@inheritDoc} */
    public void horizontalRule()
    {
<span class="fc" id="L1092">        markup( horizontalRuleElement );</span>
<span class="fc" id="L1093">    }</span>

    /** {@inheritDoc} */
    public void pageBreak()
    {
<span class="fc" id="L1098">        markup( pageBreakElement );</span>
<span class="fc" id="L1099">    }</span>

    /** {@inheritDoc} */
    public void figure()
    {
<span class="fc" id="L1104">        writeStartTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="fc" id="L1105">    }</span>

    /** {@inheritDoc} */
    public void figure_()
    {
<span class="fc" id="L1110">        writeEndTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="fc" id="L1111">    }</span>

    /**
     * &lt;p&gt;graphicElement&lt;/p&gt;
     *
     * @see SimplifiedDocbookMarkup#MEDIAOBJECT_TAG
     * @see SimplifiedDocbookMarkup#IMAGEOBJECT_TAG
     * @see SimplifiedDocbookMarkup#IMAGEDATA_TAG
     * @see SimplifiedDocbookMarkup#FORMAT_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#FILEREF_ATTRIBUTE
     * @deprecated do not use!
     */
    protected void graphicElement()
    {
<span class="nc bnc" id="L1125" title="All 2 branches missed.">        if ( graphicsFileName != null )</span>
        {
<span class="nc" id="L1127">            String format = FileUtils.extension( graphicsFileName ).toUpperCase( Locale.ENGLISH );</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">            if ( format.length() == 0 )</span>
            {
<span class="nc" id="L1130">                format = &quot;JPEG&quot;;</span>
            }

<span class="nc" id="L1133">            writeStartTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="nc" id="L1134">            writeStartTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>

<span class="nc" id="L1136">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="nc" id="L1137">            att.addAttribute( SimplifiedDocbookMarkup.FORMAT_ATTRIBUTE, format );</span>
<span class="nc" id="L1138">            att.addAttribute( SimplifiedDocbookMarkup.FILEREF_ATTRIBUTE,</span>
<span class="nc" id="L1139">                    HtmlTools.escapeHTML( graphicsFileName, true ) );</span>

<span class="nc" id="L1141">            writeSimpleTag( SimplifiedDocbookMarkup.IMAGEDATA_TAG, att );</span>

<span class="nc" id="L1143">            writeEndTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>
<span class="nc" id="L1144">            writeEndTag( SimplifiedDocbookMarkup.MEDIAOBJECT_TAG );</span>
<span class="nc" id="L1145">            graphicsFileName = null;</span>
        }
<span class="nc" id="L1147">    }</span>

    /** {@inheritDoc} */
    public void figureGraphics( String name )
    {
<span class="fc" id="L1152">        String format = FileUtils.extension( name ).toUpperCase( Locale.ENGLISH );</span>

<span class="fc" id="L1154">        writeStartTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>

<span class="fc" id="L1156">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1157">        att.addAttribute( SimplifiedDocbookMarkup.FORMAT_ATTRIBUTE, format );</span>
<span class="fc" id="L1158">        att.addAttribute( SimplifiedDocbookMarkup.FILEREF_ATTRIBUTE, HtmlTools.escapeHTML( name, true ) );</span>

<span class="fc" id="L1160">        writeSimpleTag( SimplifiedDocbookMarkup.IMAGEDATA_TAG, att );</span>

<span class="fc" id="L1162">        writeEndTag( SimplifiedDocbookMarkup.IMAGEOBJECT_TAG );</span>
<span class="fc" id="L1163">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#FIGURE_TAG
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void figureCaption()
    {
<span class="fc" id="L1172">        writeStartTag( SimplifiedDocbookMarkup.CAPTION_TAG );</span>
<span class="fc" id="L1173">        writeStartTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1174">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#FIGURE_TAG
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void figureCaption_()
    {
<span class="fc" id="L1183">        writeEndTag( SimplifiedDocbookMarkup.PARA_TAG );</span>
<span class="fc" id="L1184">        writeEndTag( SimplifiedDocbookMarkup.CAPTION_TAG );</span>
<span class="fc" id="L1185">    }</span>

    /** {@inheritDoc} */
    public void table()
    {
<span class="fc" id="L1190">        tableHasCaption = false;</span>
<span class="fc" id="L1191">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#INFORMALTABLE_TAG
     * @see SimplifiedDocbookMarkup#FRAME_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#ROWSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#COLSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#TABLE_TAG
     */
    public void table_()
    {
<span class="fc bfc" id="L1203" title="All 2 branches covered.">        if ( tableHasCaption )</span>
        {
<span class="fc" id="L1205">            tableHasCaption = false;</span>
            // Formal table+title already written to original destination ---

<span class="fc" id="L1208">            out.write( tableRows  );</span>
<span class="fc" id="L1209">            writeEndTag( TABLE_TAG );</span>
        }
        else
        {
<span class="fc" id="L1213">            String frame = &quot;none&quot;;</span>
<span class="fc" id="L1214">            String sep = &quot;0&quot;;</span>
<span class="fc bfc" id="L1215" title="All 2 branches covered.">            if ( tableHasGrid )</span>
            {
<span class="fc" id="L1217">                frame = &quot;all&quot;;</span>
<span class="fc" id="L1218">                sep = &quot;1&quot;;</span>
            }

<span class="fc" id="L1221">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1222">            att.addAttribute( SimplifiedDocbookMarkup.FRAME_ATTRIBUTE, frame );</span>
<span class="fc" id="L1223">            att.addAttribute( SimplifiedDocbookMarkup.ROWSEP_ATTRIBUTE, sep );</span>
<span class="fc" id="L1224">            att.addAttribute( SimplifiedDocbookMarkup.COLSEP_ATTRIBUTE, sep );</span>

<span class="fc" id="L1226">            writeStartTag( SimplifiedDocbookMarkup.INFORMALTABLE_TAG, att );</span>

<span class="fc" id="L1228">            out.write( tableRows  );</span>

<span class="fc" id="L1230">            writeEndTag( SimplifiedDocbookMarkup.INFORMALTABLE_TAG );</span>
        }

<span class="fc" id="L1233">        tableRows = null;</span>
<span class="fc" id="L1234">        tableHasGrid = false;</span>
<span class="fc" id="L1235">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TGROUP_TAG
     * @see SimplifiedDocbookMarkup#COLS_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#COLSPEC_TAG
     */
    public void tableRows( int[] justification, boolean grid )
    {
<span class="fc" id="L1245">        tableHasGrid = grid;</span>

        // Divert output to a string ---
<span class="fc" id="L1248">        out.flush();</span>
<span class="fc" id="L1249">        savedOut = out;</span>
<span class="fc" id="L1250">        tableRowsWriter = new StringWriter();</span>
<span class="fc" id="L1251">        out = new PrintWriter( tableRowsWriter );</span>

<span class="fc" id="L1253">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1254">        att.addAttribute( SimplifiedDocbookMarkup.COLS_ATTRIBUTE, String.valueOf( justification.length ) );</span>

<span class="fc" id="L1256">        writeStartTag( SimplifiedDocbookMarkup.TGROUP_TAG, att );</span>

<span class="fc bfc" id="L1258" title="All 2 branches covered.">        for ( int i = 0; i &lt; justification.length; ++i )</span>
        {
            String justif;
<span class="fc bfc" id="L1261" title="All 3 branches covered.">            switch ( justification[i] )</span>
            {
                case Sink.JUSTIFY_LEFT:
<span class="fc" id="L1264">                    justif = &quot;left&quot;;</span>
<span class="fc" id="L1265">                    break;</span>
                case Sink.JUSTIFY_RIGHT:
<span class="fc" id="L1267">                    justif = &quot;right&quot;;</span>
<span class="fc" id="L1268">                    break;</span>
                case Sink.JUSTIFY_CENTER:
                default:
<span class="fc" id="L1271">                    justif = &quot;center&quot;;</span>
                    break;
            }

<span class="fc" id="L1275">            att = new SimpleAttributeSet();</span>
<span class="fc" id="L1276">            att.addAttribute( &quot;align&quot;, justif );</span>

<span class="fc" id="L1278">            writeSimpleTag( SimplifiedDocbookMarkup.COLSPEC_TAG, att );</span>
        }

<span class="fc" id="L1281">        writeStartTag( SimplifiedDocbookMarkup.TBODY_TAG );</span>
<span class="fc" id="L1282">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TGROUP_TAG
     * @see SimplifiedDocbookMarkup#TBODY_TAG
     */
    public void tableRows_()
    {
<span class="fc" id="L1291">        writeEndTag( SimplifiedDocbookMarkup.TBODY_TAG );</span>
<span class="fc" id="L1292">        writeEndTag( SimplifiedDocbookMarkup.TGROUP_TAG );</span>

        // Remember diverted output and restore original destination ---
<span class="fc" id="L1295">        out.flush();</span>
<span class="pc bpc" id="L1296" title="1 of 2 branches missed.">        if ( tableRowsWriter == null )</span>
        {
<span class="nc" id="L1298">            throw new IllegalArgumentException( &quot;tableRows( int[] justification, boolean grid )&quot;</span>
                                                + &quot; was not called before.&quot; );
        }

<span class="fc" id="L1302">        tableRows = tableRowsWriter.toString();</span>
<span class="fc" id="L1303">        tableRowsWriter = null;</span>
<span class="fc" id="L1304">        out = savedOut;</span>
<span class="fc" id="L1305">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ROW_TAG
     */
    public void tableRow()
    {
<span class="fc" id="L1313">        writeStartTag( SimplifiedDocbookMarkup.ROW_TAG );</span>
<span class="fc" id="L1314">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ROW_TAG
     */
    public void tableRow_()
    {
<span class="fc" id="L1322">        writeEndTag( SimplifiedDocbookMarkup.ROW_TAG );</span>
<span class="fc" id="L1323">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableCell()
    {
<span class="fc" id="L1331">        writeStartTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1332">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableCell_()
    {
<span class="fc" id="L1340">        writeEndTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1341">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableHeaderCell()
    {
<span class="fc" id="L1349">        writeStartTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1350">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ENTRY_TAG
     */
    public void tableHeaderCell_()
    {
<span class="fc" id="L1358">        writeEndTag( SimplifiedDocbookMarkup.ENTRY_TAG );</span>
<span class="fc" id="L1359">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TABLE_TAG
     * @see SimplifiedDocbookMarkup#FRAME_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#ROWSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#COLSEP_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void tableCaption()
    {
<span class="fc" id="L1371">        tableHasCaption = true;</span>

        String frame;
        int sep;
<span class="fc bfc" id="L1375" title="All 2 branches covered.">        if ( tableHasGrid )</span>
        {
<span class="fc" id="L1377">            frame = &quot;all&quot;;</span>
<span class="fc" id="L1378">            sep = 1;</span>
        }
        else
        {
<span class="fc" id="L1382">            frame = &quot;none&quot;;</span>
<span class="fc" id="L1383">            sep = 0;</span>
        }

<span class="fc" id="L1386">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1387">        att.addAttribute( SimplifiedDocbookMarkup.FRAME_ATTRIBUTE, frame );</span>
<span class="fc" id="L1388">        att.addAttribute( SimplifiedDocbookMarkup.ROWSEP_ATTRIBUTE, String.valueOf( sep ) );</span>
<span class="fc" id="L1389">        att.addAttribute( SimplifiedDocbookMarkup.COLSEP_ATTRIBUTE, String.valueOf( sep ) );</span>

<span class="fc" id="L1391">        writeStartTag( TABLE_TAG, att );</span>

<span class="fc" id="L1393">        writeStartTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L1394">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#TITLE_TAG
     */
    public void tableCaption_()
    {
<span class="fc" id="L1402">        writeEndTag( SimplifiedDocbookMarkup.TITLE_TAG );</span>
<span class="fc" id="L1403">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ANCHOR_TAG
     */
    public void anchor( String name )
    {
<span class="pc bpc" id="L1411" title="1 of 2 branches missed.">        if ( name == null )</span>
        {
<span class="nc" id="L1413">            throw new NullPointerException( &quot;Anchor name cannot be null!&quot; );</span>
        }

<span class="pc bpc" id="L1416" title="1 of 2 branches missed.">        if ( authorDateFlag )</span>
        {
<span class="nc" id="L1418">            return;</span>
        }

<span class="fc" id="L1421">        String id = name;</span>

<span class="pc bpc" id="L1423" title="1 of 2 branches missed.">        if ( !DoxiaUtils.isValidId( id ) )</span>
        {
<span class="nc" id="L1425">            id = DoxiaUtils.encodeId( name, true );</span>

<span class="nc" id="L1427">            String msg = &quot;Modified invalid anchor name: '&quot; + name + &quot;' to '&quot; + id + &quot;'&quot;;</span>
<span class="nc" id="L1428">            logMessage( &quot;modifiedLink&quot;, msg );</span>
        }

<span class="fc" id="L1431">        MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1432">        att.addAttribute( ID_ATTRIBUTE, id );</span>

<span class="fc" id="L1434">        writeSimpleTag( SimplifiedDocbookMarkup.ANCHOR_TAG, att );</span>
<span class="fc" id="L1435">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ANCHOR_TAG
     */
    public void anchor_()
    {
<span class="fc" id="L1443">        comment( &quot; anchor_end &quot; );</span>
<span class="fc" id="L1444">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ULINK_TAG
     * @see SimplifiedDocbookMarkup#URL_ATTRIBUTE
     * @see SimplifiedDocbookMarkup#LINK_TAG
     * @see SimplifiedDocbookMarkup#LINKEND_ATTRIBUTE
     */
    public void link( String name )
    {
<span class="pc bpc" id="L1455" title="1 of 2 branches missed.">        if ( name == null )</span>
        {
<span class="nc" id="L1457">            throw new NullPointerException( &quot;Link name cannot be null!&quot; );</span>
        }

<span class="fc bfc" id="L1460" title="All 2 branches covered.">        if ( DoxiaUtils.isInternalLink( name ) )</span>
        {
<span class="fc" id="L1462">            String linkend = name.substring( 1 );</span>
<span class="fc" id="L1463">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1464">            att.addAttribute( SimplifiedDocbookMarkup.LINKEND_ATTRIBUTE, HtmlTools.escapeHTML( linkend ) );</span>

<span class="fc" id="L1466">            writeStartTag( SimplifiedDocbookMarkup.LINK_TAG, att );</span>
<span class="fc" id="L1467">        }</span>
        else
        {
<span class="fc" id="L1470">            externalLinkFlag = true;</span>
<span class="fc" id="L1471">            MutableAttributeSet att = new SimpleAttributeSet();</span>
<span class="fc" id="L1472">            att.addAttribute( SimplifiedDocbookMarkup.URL_ATTRIBUTE, HtmlTools.escapeHTML( name, true ) );</span>

<span class="fc" id="L1474">            writeStartTag( SimplifiedDocbookMarkup.ULINK_TAG, att );</span>
        }
<span class="fc" id="L1476">    }</span>

    /**
     * {@inheritDoc}
     * @see SimplifiedDocbookMarkup#ULINK_TAG
     * @see SimplifiedDocbookMarkup#LINK_TAG
     */
    public void link_()
    {
<span class="fc bfc" id="L1485" title="All 2 branches covered.">        if ( externalLinkFlag )</span>
        {
<span class="fc" id="L1487">            writeEndTag( SimplifiedDocbookMarkup.ULINK_TAG );</span>
<span class="fc" id="L1488">            externalLinkFlag = false;</span>
        }
        else
        {
<span class="fc" id="L1492">            writeEndTag( SimplifiedDocbookMarkup.LINK_TAG );</span>
        }
<span class="fc" id="L1494">    }</span>

    /** {@inheritDoc} */
    public void italic()
    {
<span class="fc" id="L1499">        markup( italicBeginTag );</span>
<span class="fc" id="L1500">    }</span>

    /** {@inheritDoc} */
    public void italic_()
    {
<span class="fc" id="L1505">        markup( italicEndTag );</span>
<span class="fc" id="L1506">    }</span>

    /** {@inheritDoc} */
    public void bold()
    {
<span class="fc" id="L1511">        markup( boldBeginTag );</span>
<span class="fc" id="L1512">    }</span>

    /** {@inheritDoc} */
    public void bold_()
    {
<span class="fc" id="L1517">        markup( boldEndTag );</span>
<span class="fc" id="L1518">    }</span>

    /** {@inheritDoc} */
    public void monospaced()
    {
<span class="pc bpc" id="L1523" title="1 of 2 branches missed.">        if ( !authorDateFlag )</span>
        {
<span class="fc" id="L1525">            markup( monospacedBeginTag );</span>
        }
<span class="fc" id="L1527">    }</span>

    /** {@inheritDoc} */
    public void monospaced_()
    {
<span class="pc bpc" id="L1532" title="1 of 2 branches missed.">        if ( !authorDateFlag )</span>
        {
<span class="fc" id="L1534">            markup( monospacedEndTag );</span>
        }
<span class="fc" id="L1536">    }</span>

    /** {@inheritDoc} */
    public void lineBreak()
    {
<span class="fc" id="L1541">        markup( lineBreakElement );</span>
<span class="fc" id="L1542">    }</span>

    /** {@inheritDoc} */
    public void nonBreakingSpace()
    {
<span class="fc" id="L1547">        markup( &quot;&amp;#x00A0;&quot; );</span>
        //markup( &quot;&amp;nbsp;&quot; );
<span class="fc" id="L1549">    }</span>

    /** {@inheritDoc} */
    public void text( String text )
    {
<span class="fc bfc" id="L1554" title="All 2 branches covered.">        if ( verbatimFlag )</span>
        {
<span class="fc" id="L1556">            verbatimContent( text );</span>
        }
        else
        {
<span class="fc" id="L1560">            content( text );</span>
        }
<span class="fc" id="L1562">    }</span>

    /** {@inheritDoc} */
    public void comment( String comment )
    {
<span class="pc bpc" id="L1567" title="1 of 2 branches missed.">        if ( comment != null )</span>
        {
<span class="fc" id="L1569">            String originalComment = comment;</span>

            // http://www.w3.org/TR/2000/REC-xml-20001006#sec-comments
<span class="fc bfc" id="L1572" title="All 2 branches covered.">            while ( comment.contains( &quot;--&quot; ) )</span>
            {
<span class="fc" id="L1574">                comment = comment.replace( &quot;--&quot;, &quot;- -&quot; );</span>
            }

<span class="fc bfc" id="L1577" title="All 2 branches covered.">            if ( comment.endsWith( &quot;-&quot; ) )</span>
            {
<span class="fc" id="L1579">                comment += &quot; &quot;;</span>
            }

<span class="fc bfc" id="L1582" title="All 2 branches covered.">            if ( !originalComment.equals( comment ) )</span>
            {
<span class="fc" id="L1584">                String msg = &quot;Modified invalid comment: '&quot; + originalComment + &quot;' to '&quot; + comment + &quot;'&quot;;</span>
<span class="fc" id="L1585">                logMessage( &quot;modifiedComment&quot;, msg );</span>
            }

<span class="fc" id="L1588">            StringBuilder buffer = new StringBuilder( comment.length() + 7 );</span>

<span class="fc" id="L1590">            buffer.append( LESS_THAN ).append( BANG ).append( MINUS ).append( MINUS );</span>
<span class="fc" id="L1591">            buffer.append( comment );</span>
<span class="fc" id="L1592">            buffer.append( MINUS ).append( MINUS ).append( GREATER_THAN );</span>

<span class="fc" id="L1594">            markup( buffer.toString() );</span>
        }
<span class="fc" id="L1596">    }</span>

    /**
     * {@inheritDoc}
     *
     * Unknown events just log a warning message but are ignored otherwise.
     * @see org.apache.maven.doxia.sink.Sink#unknown(String,Object[],SinkEventAttributes)
     */
    public void unknown( String name, Object[] requiredParams, SinkEventAttributes attributes )
    {
<span class="fc" id="L1606">        String msg = &quot;Unknown Sink event: '&quot; + name + &quot;', ignoring!&quot;;</span>
<span class="fc" id="L1607">        logMessage( &quot;unknownEvent&quot;, msg );</span>
<span class="fc" id="L1608">    }</span>

    // -----------------------------------------------------------------------

    /**
     * Write text to output, preserving white space.
     *
     * @param text The text to write.
     */
    protected void markup( String text )
    {
<span class="pc bpc" id="L1619" title="1 of 2 branches missed.">        if ( !skip )</span>
        {
<span class="fc" id="L1621">            out.write( text );</span>
        }
<span class="fc" id="L1623">    }</span>

    /**
     * Write SGML escaped text to output, not preserving white space.
     *
     * @param text The text to write.
     */
    protected void content( String text )
    {
<span class="pc bpc" id="L1632" title="1 of 2 branches missed.">        if ( !skip )</span>
        {
<span class="fc" id="L1634">            out.write( HtmlTools.escapeHTML( text, true ) );</span>
        }
<span class="fc" id="L1636">    }</span>

    /**
     * Write SGML escaped text to output, preserving white space.
     *
     * @param text The text to write.
     */
    protected void verbatimContent( String text )
    {
<span class="pc bpc" id="L1645" title="1 of 2 branches missed.">        if ( !skip )</span>
        {
<span class="fc" id="L1647">            out.write( HtmlTools.escapeHTML( text, true ) );</span>
        }
<span class="fc" id="L1649">    }</span>

    // -----------------------------------------------------------------------

    /** {@inheritDoc} */
    public void flush()
    {
<span class="fc" id="L1656">        out.flush();</span>
<span class="fc" id="L1657">    }</span>

    /** {@inheritDoc} */
    public void close()
    {
<span class="fc" id="L1662">        out.close();</span>

<span class="pc bpc" id="L1664" title="1 of 4 branches missed.">        if ( getLog().isWarnEnabled() &amp;&amp; this.warnMessages != null )</span>
        {
<span class="fc bfc" id="L1666" title="All 2 branches covered.">            for ( Map.Entry&lt;String, Set&lt;String&gt;&gt; entry : this.warnMessages.entrySet() )</span>
            {
<span class="fc bfc" id="L1668" title="All 2 branches covered.">                for ( String msg : entry.getValue() )</span>
                {
<span class="fc" id="L1670">                    getLog().warn( msg );</span>
<span class="fc" id="L1671">                }</span>
<span class="fc" id="L1672">            }</span>

<span class="fc" id="L1674">            this.warnMessages = null;</span>
        }
<span class="fc" id="L1676">    }</span>

    /** {@inheritDoc} */
    protected void write( String text )
    {
<span class="fc" id="L1681">        markup( unifyEOLs( text ) );</span>
<span class="fc" id="L1682">    }</span>

    /**
     * &lt;p&gt;Setter for the field &lt;code&gt;skip&lt;/code&gt;.&lt;/p&gt;
     *
     * @param skip the skip to set.
     * @since 1.1
     */
    public void setSkip( boolean skip )
    {
<span class="nc" id="L1692">        this.skip = skip;</span>
<span class="nc" id="L1693">    }</span>

    /**
     * If debug mode is enabled, log the &lt;code&gt;msg&lt;/code&gt; as is, otherwise add unique msg in &lt;code&gt;warnMessages&lt;/code&gt;.
     *
     * @param key not null
     * @param msg not null
     * @see #close()
     * @since 1.1.1
     */
    private void logMessage( String key, String msg )
    {
<span class="fc" id="L1705">        msg = &quot;[Docbook Sink] &quot; + msg;</span>
<span class="pc bpc" id="L1706" title="1 of 2 branches missed.">        if ( getLog().isDebugEnabled() )</span>
        {
<span class="nc" id="L1708">            getLog().debug( msg );</span>

<span class="nc" id="L1710">            return;</span>
        }

<span class="fc bfc" id="L1713" title="All 2 branches covered.">        if ( warnMessages == null )</span>
        {
<span class="fc" id="L1715">            warnMessages = new HashMap&lt;String, Set&lt;String&gt;&gt;();</span>
        }

<span class="fc" id="L1718">        Set&lt;String&gt; set = warnMessages.get( key );</span>
<span class="fc bfc" id="L1719" title="All 2 branches covered.">        if ( set == null )</span>
        {
<span class="fc" id="L1721">            set = new TreeSet&lt;String&gt;();</span>
        }
<span class="fc" id="L1723">        set.add( msg );</span>
<span class="fc" id="L1724">        warnMessages.put( key, set );</span>
<span class="fc" id="L1725">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>